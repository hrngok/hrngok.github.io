<!DOCTYPE html>
<html prefix="        og: http://ogp.me/ns# article: http://ogp.me/ns/article#     " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Cyclic Nature of Time- Kaggle Submission | Data to Wisdom</title>
<link href="https://fonts.googleapis.com/css?family=Bitter:400,400i,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://example.com/posts/bikeshare%20part2/">
<!--[if lt IE 9]><script src="../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><meta name="author" content="Harun">
<link rel="prev" href="../bikeshare/" title="Feature Selection by Visualization" type="text/html">
<link rel="next" href="../tree-based%20models/" title="Tree-based Models" type="text/html">
<meta property="og:site_name" content="Data to Wisdom">
<meta property="og:title" content="Cyclic Nature of Time- Kaggle Submission">
<meta property="og:url" content="https://example.com/posts/bikeshare%20part2/">
<meta property="og:description" content="With this notebook we continue our analysis of bikeshare dataset.
In this part we will do machine learning steps in order to predict the bike rentals for the given Kaggle test set and submit it to the">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2018-11-16T22:08:04+02:00">
<meta property="article:tag" content="cyclic time features">
<meta property="article:tag" content="Kaggle">
<meta property="article:tag" content="timeseries data">
<meta property="article:tag" content="TimeSeriesSplit">
</head>
<body>
    <a href="#page-content" class="sr-only sr-only-focusable">Skip to main content</a>
    <section class="social"><ul>
<li><a href="../../index.html" title="Home"><i class="fa fa-home"></i></a></li>
            <li><a href="../../pages/about-me/index.html" title="About me"><i class="fa fa-user"></i></a></li>
            <li><a href="../../archive.html" title="Archives"><i class="fa fa-folder-open"></i></a></li>
            <li><a href="../../categories/index.html" title="Tags"><i class="fa fa-tags"></i></a></li>
    
    

        </ul></section><section class="page-content"><div class="content" rel="main">
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="../bikeshare%20part2/" class="u-url">Cyclic Nature of Time- Kaggle Submission</a></h1>

        <div class="metadata">
            <p class="dateline"><a href="../bikeshare%20part2/" rel="bookmark"><i class="fa fa-clock"></i> <time class="published dt-published" datetime="2018-11-16T22:08:04+02:00" itemprop="datePublished" title="2018-11-16 22:08">2018-11-16 22:08</time></a></p>
            <p class="byline author vcard"> <i class="fa fa-user"></i> <span class="byline-name fn" itemprop="author">
                    Harun
            </span></p>
                <p class="commentline"><i class="far fa-comment"></i>
        


            
        </p>
<p class="sourceline"><a href="../bikeshare%20part2/index.ipynb" class="sourcelink"><i class="fa fa-file-code"></i> Source</a></p>

            

            
    <div class="tags">
<h3 class="metadata-title">
<i class="fa fa-tags"></i> Tags:</h3>
        <ul itemprop="keywords" class="tags-ul">
<li><a class="tag p-category" href="../../categories/cyclic-time-features/" rel="tag">cyclic time features</a></li>
            <li><a class="tag p-category" href="../../categories/kaggle/" rel="tag">Kaggle</a></li>
            <li><a class="tag p-category" href="../../categories/timeseries-data/" rel="tag">timeseries data</a></li>
            <li><a class="tag p-category" href="../../categories/timeseriessplit/" rel="tag">TimeSeriesSplit</a></li>
        </ul>
</div>

        </div>
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>With this notebook we continue our analysis of <code>bikeshare</code> dataset.</li>
<li>In this part we will do machine learning steps in order to predict the bike rentals for the given Kaggle test set and submit it to the Kaggle</li>
</ul>
<p><img src="../../images/timecycle.jpg" alt="time"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<!-- TEASER_END -->
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>In the previous post, we prepared the dataset partially </li>
<li>We created new columns and dropped the outliers regarding to the <code>"count"</code> column </li>
<li>Now we start by loading the dataset and continue to prepare it before applying machine learning algorithms</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Outline:">Outline:<a class="anchor-link" href="../bikeshare%20part2/#Outline:">¶</a>
</h3>
<ul>
<li>About Time Data</li>
<li>Trigonometric functions for cyclic time data transformation</li>
<li>Data Split</li>
<li>TimeSeriesSplit for the cross validation </li>
<li>Sklearn Pipeline</li>
<li>Interpratation of RSMLE metric</li>
<li>Creating a custom scoring function </li>
<li>Kaggle submission </li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Import the necessary modules</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="k">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">TimeSeriesSplit</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="k">import</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="k">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="k">import</span> <span class="n">make_scorer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="k">import</span> <span class="n">Pipeline</span>

<span class="kn">import</span> <span class="nn">warnings</span> 
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">)</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Let's-remind-our-dataset">Let's remind our dataset<a class="anchor-link" href="../bikeshare%20part2/#Let's-remind-our-dataset">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Kaggle-terms-for-the-dataset:">Kaggle terms for the dataset:<a class="anchor-link" href="../bikeshare%20part2/#Kaggle-terms-for-the-dataset:">¶</a>
</h5>
<ul>
<li>
<p>The training set is comprised of the first <code>19 days</code> of each month, while the test set comprised of the days from <code>20th</code>  to the end of the month for each month.</p>
</li>
<li>
<p>Predict the <code>total count of bikes rented during each hour</code> covered by the test set, using only <code>information available prior to the rental period</code>.</p>
</li>
</ul>
<p>Here is the <a href="https://www.kaggle.com/c/bike-sharing-demand/data">Kaggle link for the dataset</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Read the bike_data_inliers</span>
<span class="n">bike_data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"bike_data_inliers.csv"</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s2">"datetime"</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="s2">"datetime"</span><span class="p">)</span>
<span class="n">bike_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[2]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
      <th>season</th>
      <th>holiday</th>
      <th>workingday</th>
      <th>weather</th>
      <th>temp</th>
      <th>atemp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>casual</th>
      <th>registered</th>
      <th>count</th>
      <th>month</th>
      <th>weekday</th>
      <th>hour</th>
    </tr>
<tr>
<th>datetime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
</thead>
<tbody>
<tr>
<th>2011-01-01 00:00:00</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>81</td>
      <td>0.0</td>
      <td>3</td>
      <td>13</td>
      <td>16</td>
      <td>1</td>
      <td>5</td>
      <td>0</td>
    </tr>
<tr>
<th>2011-01-01 01:00:00</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.02</td>
      <td>13.635</td>
      <td>80</td>
      <td>0.0</td>
      <td>8</td>
      <td>32</td>
      <td>40</td>
      <td>1</td>
      <td>5</td>
      <td>1</td>
    </tr>
<tr>
<th>2011-01-01 02:00:00</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.02</td>
      <td>13.635</td>
      <td>80</td>
      <td>0.0</td>
      <td>5</td>
      <td>27</td>
      <td>32</td>
      <td>1</td>
      <td>5</td>
      <td>2</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">## Filter out the casual and registered columns and </span>
<span class="c1">## high correlated columns "season" (correlated with "month") and "atemp" (correlated with "temp") should be omitted</span>
<span class="c1">## Also in the previous post we noticed that the data record in the "weather" column is not relaible</span>
<span class="c1">## We will also drop it</span>
<span class="n">bike_data</span><span class="o">=</span> <span class="n">bike_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">"casual"</span><span class="p">,</span> <span class="s2">"registered"</span><span class="p">,</span> <span class="s2">"season"</span><span class="p">,</span> <span class="s2">"atemp"</span><span class="p">,</span> <span class="s2">"weather"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">bike_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[3]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
      <th>holiday</th>
      <th>workingday</th>
      <th>temp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>count</th>
      <th>month</th>
      <th>weekday</th>
      <th>hour</th>
    </tr>
<tr>
<th>datetime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
</thead>
<tbody>
<tr>
<th>2011-01-01 00:00:00</th>
      <td>0</td>
      <td>0</td>
      <td>9.84</td>
      <td>81</td>
      <td>0.0</td>
      <td>16</td>
      <td>1</td>
      <td>5</td>
      <td>0</td>
    </tr>
<tr>
<th>2011-01-01 01:00:00</th>
      <td>0</td>
      <td>0</td>
      <td>9.02</td>
      <td>80</td>
      <td>0.0</td>
      <td>40</td>
      <td>1</td>
      <td>5</td>
      <td>1</td>
    </tr>
<tr>
<th>2011-01-01 02:00:00</th>
      <td>0</td>
      <td>0</td>
      <td>9.02</td>
      <td>80</td>
      <td>0.0</td>
      <td>32</td>
      <td>1</td>
      <td>5</td>
      <td>2</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="About-Time-Data">About Time Data<a class="anchor-link" href="../bikeshare%20part2/#About-Time-Data">¶</a>
</h3>
<ul>
<li>Since our data is a timeseries, i.e data recorded with a time dimension, we need to take into account the timeseries practices.</li>
</ul>
<ul>
<li>Firstly, we need to be aware of the <code>cyclic</code> nature of our time data</li>
</ul>
<ul>
<li>As we walked through the time frame charts in the previous post, we saw that <code>month</code>  and <code>hour</code> variables are very predictive over the number of bike rentals. </li>
</ul>
<ul>
<li>This is very resaonable as we might expect that the bike usage and rentals during <code>January</code> is less than <code>May</code> due to the weather conditions and rentals at <code>3am</code> in the morning is less than at <code>14h</code>, during the day. </li>
</ul>
<ul>
<li>
<p>So we should use the <code>"month"</code> and <code>"hour"</code> data as features for our models. However, we have a problem of how to utilize these features.</p>
</li>
<li>
<p>We need to keep them <strong>numeric</strong> for the machine learning algorithms but if we use them without any transformation, it would not be so smart practice.</p>
</li>
</ul>
<p>To make it clearer here is a question:</p>
<ul>
<li>Which one would you expect is more similar to the bike rentals in <code>January</code>: rentals in <code>December</code> or rentals in <code>May</code>? </li>
</ul>
<ul>
<li>
<p>Regarding the seasonal affects we can tell that number of bike rentals in <code>December</code> is more similar to rentals in <code>January</code>, however we represent <code>December</code> with number <code>12</code> and <code>May</code> with number <code>5</code>.</p>
</li>
<li>
<p>This is a wrong representation of the time features especially for the algorithms that use distance or the algorithms like linear regression.</p>
</li>
</ul>
<blockquote>
<p>As an example let's assume our model is $$ bikerentals= 15+ 2*hour $$<br>
At 0h the number of estimated rentals = 15 <br>
At 23h the number of estimated rentals= 61 <br>
Even though there is only 1 hour difference between 0h-23h with this represantation the difference is the largest</p>
</blockquote>
<ul>
<li>Because of the cyclic nature of the months and hours we need to find a way of representing these features such that    <ul>
<li>the <code>12th</code> month should be closer to <code>1st</code> month than <code>5th</code> month or </li>
<li>
<code>23th</code> hour should be closer to <code>1st</code> hour than <code>7th hour</code>. </li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Representation-of--Cyclic-Time-Features">Representation of  Cyclic Time Features<a class="anchor-link" href="../bikeshare%20part2/#Representation-of--Cyclic-Time-Features">¶</a>
</h3>
<ul>
<li>
<p>We map each cyclical variable onto a circle such that the <code>lowest value</code> for that variable appears right next to the <code>largest value</code>.</p>
</li>
<li>
<p>We represent each variable with two components: x axis value and y axis value</p>
</li>
<li>
<p>We compute the <code>x</code> and <code>y</code> components of that point using <code>sin</code> and <code>cos</code> functions.</p>
</li>
</ul>
<p><img src="../../images/hours.jpg" alt="hours"></p>
<p>Note that when we perform this transformation for the <code>"month"</code> variable, we also shift the values down by one such that it extends from <code>0 to 11</code>, for convenience</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Create the sin and cos components of hour, month and weekday columns</span>
<span class="n">bike_data</span><span class="p">[</span><span class="s1">'hour_sin'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">bike_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">24</span><span class="p">))</span>
<span class="n">bike_data</span><span class="p">[</span><span class="s1">'hour_cos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">bike_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">24</span><span class="p">))</span>
<span class="n">bike_data</span><span class="p">[</span><span class="s1">'month_sin'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">bike_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">12</span><span class="p">))</span>
<span class="n">bike_data</span><span class="p">[</span><span class="s1">'month_cos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">bike_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">12</span><span class="p">))</span>
<span class="n">bike_data</span><span class="p">[</span><span class="s2">"weekday_cos"</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">bike_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">weekday</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">7</span><span class="p">))</span>
<span class="n">bike_data</span><span class="p">[</span><span class="s1">'weekday_sin'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">bike_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">weekday</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">7</span><span class="p">))</span>

<span class="c1"># Now we can drop the columns "month", "weekday" and "hour"</span>
<span class="n">bike_data</span><span class="o">=</span><span class="n">bike_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">"month"</span><span class="p">,</span> <span class="s2">"weekday"</span><span class="p">,</span> <span class="s2">"hour"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Split-the-data">Split the data<a class="anchor-link" href="../bikeshare%20part2/#Split-the-data">¶</a>
</h3>
<ul>
<li>
<p>Even though there is a given test set (without target variable) for Kaggle submission we will analyse the data as an independent project and follow our data splitting principles</p>
</li>
<li>
<p>At the end we will use the Kaggle test set for submission</p>
</li>
<li>
<p>So, after fitting a model we will use <strong>cross validation</strong> for evaluating model performance and hyperparameter tuning but we still we need to keep an <strong>hold-out set</strong> for our final evaluation.</p>
</li>
<li>
<p>Since this is a timeseries dataset we must respect to the temporal order of the data. Thus, we must use only the past data to predict the future data.</p>
</li>
<li>
<p>So we can take the <strong>last %5</strong> as our hold-out data. (In the Kaggle competition the test set is the last 10 days of the months)</p>
</li>
<li>
<p>We need to split the data before doing transformation (incase we do) because test data points represent real-world data.</p>
</li>
<li>Transformation of the variables use information from the dataset like <strong>mean</strong> and <strong>standard deviation</strong>
</li>
<li>
<p>If we transform the data before splitting we take information like mean and variance of the whole dataset thus we will be <strong>introducing future information to the training data</strong>.</p>
</li>
<li>
<p>Therefore, we should perform transformation over the training data. Then perform the same transformation on testing data as well, but this time using the parameters (like mean and variance) of the training data.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Find the starting indice of the last five percent</span>
<span class="n">last_five_percent_ind</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bike_data</span><span class="p">)</span><span class="o">*</span> <span class="mf">0.95</span><span class="p">)</span>
<span class="n">last_five_percent_ind</span>

<span class="c1"># Create the hold-out dataset</span>
<span class="n">hold_out_df</span><span class="o">=</span><span class="n">bike_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">last_five_percent_ind</span><span class="p">:</span> <span class="p">,:]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"The shape of the hold-out dataset:"</span><span class="p">,</span> <span class="n">hold_out_df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">hold_out_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The shape of the hold-out dataset: (522, 13)
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[5]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>datetime</th>
      <th>holiday</th>
      <th>workingday</th>
      <th>temp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>count</th>
      <th>hour_sin</th>
      <th>hour_cos</th>
      <th>month_sin</th>
      <th>month_cos</th>
      <th>weekday_cos</th>
      <th>weekday_sin</th>
    </tr></thead>
<tbody>
<tr>
<th>9914</th>
      <td>2012-11-16 06:00:00</td>
      <td>0</td>
      <td>1</td>
      <td>12.30</td>
      <td>61</td>
      <td>6.0032</td>
      <td>130</td>
      <td>1.000000</td>
      <td>6.123234e-17</td>
      <td>-0.866025</td>
      <td>0.5</td>
      <td>-0.900969</td>
      <td>-0.433884</td>
    </tr>
<tr>
<th>9915</th>
      <td>2012-11-16 07:00:00</td>
      <td>0</td>
      <td>1</td>
      <td>12.30</td>
      <td>61</td>
      <td>11.0014</td>
      <td>367</td>
      <td>0.965926</td>
      <td>-2.588190e-01</td>
      <td>-0.866025</td>
      <td>0.5</td>
      <td>-0.900969</td>
      <td>-0.433884</td>
    </tr>
<tr>
<th>9916</th>
      <td>2012-11-16 09:00:00</td>
      <td>0</td>
      <td>1</td>
      <td>13.94</td>
      <td>53</td>
      <td>7.0015</td>
      <td>351</td>
      <td>0.707107</td>
      <td>-7.071068e-01</td>
      <td>-0.866025</td>
      <td>0.5</td>
      <td>-0.900969</td>
      <td>-0.433884</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will do training and cross validation on the rest of the data. Lets create it</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">=</span> <span class="n">bike_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">last_five_percent_ind</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">data</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[6]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>datetime</th>
      <th>holiday</th>
      <th>workingday</th>
      <th>temp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>count</th>
      <th>hour_sin</th>
      <th>hour_cos</th>
      <th>month_sin</th>
      <th>month_cos</th>
      <th>weekday_cos</th>
      <th>weekday_sin</th>
    </tr></thead>
<tbody>
<tr>
<th>9911</th>
      <td>2012-11-16 03:00:00</td>
      <td>0</td>
      <td>1</td>
      <td>12.3</td>
      <td>65</td>
      <td>8.9981</td>
      <td>6</td>
      <td>0.707107</td>
      <td>0.707107</td>
      <td>-0.866025</td>
      <td>0.5</td>
      <td>-0.900969</td>
      <td>-0.433884</td>
    </tr>
<tr>
<th>9912</th>
      <td>2012-11-16 04:00:00</td>
      <td>0</td>
      <td>1</td>
      <td>12.3</td>
      <td>65</td>
      <td>7.0015</td>
      <td>5</td>
      <td>0.866025</td>
      <td>0.500000</td>
      <td>-0.866025</td>
      <td>0.5</td>
      <td>-0.900969</td>
      <td>-0.433884</td>
    </tr>
<tr>
<th>9913</th>
      <td>2012-11-16 05:00:00</td>
      <td>0</td>
      <td>1</td>
      <td>12.3</td>
      <td>65</td>
      <td>6.0032</td>
      <td>36</td>
      <td>0.965926</td>
      <td>0.258819</td>
      <td>-0.866025</td>
      <td>0.5</td>
      <td>-0.900969</td>
      <td>-0.433884</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Features-and-Target-Variable">Features and Target Variable<a class="anchor-link" href="../bikeshare%20part2/#Features-and-Target-Variable">¶</a>
</h4>
<p>Having splitted the hold-out dataset, now time to create the features (X) and the target (y) datasets and fit a Linear Regression model</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Target data</span>
<span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">"count"</span><span class="p">]</span>

<span class="c1"># Features data</span>
<span class="n">X</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">"datetime"</span><span class="p">,</span> <span class="s2">"count"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[8]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>holiday</th>
      <th>workingday</th>
      <th>temp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>hour_sin</th>
      <th>hour_cos</th>
      <th>month_sin</th>
      <th>month_cos</th>
      <th>weekday_cos</th>
      <th>weekday_sin</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>0</td>
      <td>0</td>
      <td>9.84</td>
      <td>81</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>-0.222521</td>
      <td>-0.974928</td>
    </tr>
<tr>
<th>1</th>
      <td>0</td>
      <td>0</td>
      <td>9.02</td>
      <td>80</td>
      <td>0.0</td>
      <td>0.258819</td>
      <td>0.965926</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>-0.222521</td>
      <td>-0.974928</td>
    </tr>
<tr>
<th>2</th>
      <td>0</td>
      <td>0</td>
      <td>9.02</td>
      <td>80</td>
      <td>0.0</td>
      <td>0.500000</td>
      <td>0.866025</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>-0.222521</td>
      <td>-0.974928</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Notes-about-Cross-Validation-of-Timeseries-Data">Notes about Cross Validation of Timeseries Data<a class="anchor-link" href="../bikeshare%20part2/#Notes-about-Cross-Validation-of-Timeseries-Data">¶</a>
</h3>
<p>Here is the the notes from <a href="https://scikit-learn.org/stable/modules/cross_validation.html#cross-validation">sklearn official page</a> :</p>
<p>Time series data is characterised by the <strong>correlation between observations that are near in time (autocorrelation)</strong>.</p>
<p>However, classical cross-validation techniques such as <code>KFold</code> and <code>ShuffleSplit</code></p>
<ul>
<li>assume the samples are <strong>independent</strong> and <strong>identically distributed</strong>, and </li>
<li>would result in unreasonable correlation between training and testing instances (yielding poor estimates of generalisation error) on time series data. </li>
</ul>
<p>Therefore, it is very important to evaluate our model for time series data on the “future” observations least like those that are used to train the model.</p>
<h4 id="Time-Series-Split">Time Series Split<a class="anchor-link" href="../bikeshare%20part2/#Time-Series-Split">¶</a>
</h4>
<p><code>TimeSeriesSplit</code> is a variation of k-fold which</p>
<ul>
<li>returns first <code>k</code> folds as train set and </li>
<li>the <code>k+1 th</code> fold as test set. </li>
</ul>
<ul>
<li>We should <strong>not shuffle</strong> our data when making predictions with timeseries.</li>
<li>Unlike standard cross-validation methods, successive training sets are <strong>supersets</strong> of those that come before them. </li>
<li>Also, it adds all <strong>surplus data</strong> to the <strong>first training partition</strong>, which is always used to train the model.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Sklearn-Pipeline">Sklearn Pipeline<a class="anchor-link" href="../bikeshare%20part2/#Sklearn-Pipeline">¶</a>
</h3>
<p>Whenever possible, using Sklearn Pipeline object is always a smart practice because they</p>
<ul>
<li>are powerfull tools to standardise our operations,</li>
<li>create an easy-to-understand workflow with clear order of steps,</li>
<li>are reproducable</li>
</ul>
<p>We will create a pipeline with <code>StandartScaler</code> and <code>LinearRegression</code> objects</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Instantiate the pipeline with the StandardScaler and  LinearRegression</span>
<span class="n">pipeline</span><span class="o">=</span><span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span> <span class="p">[(</span><span class="s2">"scaler"</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
                          <span class="p">(</span><span class="s2">"linreg"</span><span class="p">,</span> <span class="n">LinearRegression</span><span class="p">())])</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Cross-validation-scores">Cross validation scores<a class="anchor-link" href="../bikeshare%20part2/#Cross-validation-scores">¶</a>
</h3>
<p>Let's use the <code>cross_val_score</code> from <code>sklearn.metrics</code> to get the scores of each split</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Split the timeseries data</span>
<span class="n">split</span> <span class="o">=</span> <span class="n">TimeSeriesSplit</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Fit and score the model with cross-validation</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">split</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"R^2 scores of each split:"</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>R^2 scores of each split: [0.27492746 0.32817026 0.19586317 0.37070607 0.41382806]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id='Visualizing-CV-Splits-for-Timeseries:-"TimeSeriesSplit"'>Visualizing CV Splits for Timeseries: "TimeSeriesSplit"<a class="anchor-link" href="../bikeshare%20part2/#Visualizing-CV-Splits-for-Timeseries:-%22TimeSeriesSplit%22">¶</a>
</h3>
<p>Visualize the splits of cross validation with <code>TimeSeriesSplit</code> object</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Initialize the cross-validation iterator with 10 splits</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">TimeSeriesSplit</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> 

<span class="c1"># Loop over the cross validation splits</span>
<span class="c1"># cv.split() method creates train and test arrays for each split</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)):</span>

    <span class="c1"># Plot training and test indices</span>
    <span class="n">indeces1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">coolwarm</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'_'</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">indeces2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">coolwarm</span><span class="p">(</span><span class="o">.</span><span class="mi">9</span><span class="p">)],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'_'</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">'TimeSeriesSplit behavior'</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">'Data index'</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">'CV iterates'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">indeces1</span><span class="p">,</span> <span class="n">indeces2</span><span class="p">],</span> <span class="p">[</span><span class="s1">'Training'</span><span class="p">,</span> <span class="s1">'Validation'</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="data:image/png;base64,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YPYIwOzZz9Dd3ZoHFiZOXJNZsxwQuyS2SZlsl/LYJuWxTcrTzDbp7Oxg7bXHQp1fGrUyBbNFAN3dPS0LZov3p7LYJmWyXcpjm5THNilPC9pkQK91W5lu/pckSRrWDGaSJEmFWJkuZUqSpEFYtGghs2fPZOHCBe0upSiPP95Jd3f3Cm1j9OgxrL12F6NGDU2kMphJkjTMzZ49k9VWW4OxY9elo6Oj3eUUY/ToThYuHHww6+np4Zln5jJ79kwmTZq8/BUa4KVMSZKGuYULFzB27HhD2RDr6Ohg7NjxQ9oTaTCTJGkEMJQ1x1AfV4OZJElSIbzHTJIktdRZZ53BH/94BwsXvsBDDz3IlCkbAPC+9/0Te+31zuWuP336NDbeeBN23HHnfpc55JADueii7w9Zza1iMJMkSS9z7Flz+px/9nETVnjbxx33SQAeeeRhPvKRDw04QB1++FHLXWZlDGVgMJMkSYWYMeN87rzzTzz++KO8970HMGXKa/nmN8/l+eef4+mn5/HRj36cnXbahc997jS22mobttpqGz71qePZYIPX8ec/J+usM5HPfOaLjB8/gR133JYbbriFGTPO54knZvLgg3/nscceZe+99+Xggw9j4cKFnHHGF7j99t/T1fUKOjo6OPjgw9h6623begwMZpIkqRgLFjzPd7/7nwCcfPInOPHEqay//hRuvfVmzj77y+y00y4vWf4vf7mXk046hY022phPf/oErrzycvbb759etsy5505n3ryn2X//d/Ge9+zPFVdcxvz58/n+9y/hscce5aCDXrpOuxjMJElSMTbd9A1LPk+d+hluvPF6fv3rq7nzzj8yf/78ly2/9trrsNFGGwOwwQYbMnfu3Jcts/XW27LKKquw9trrMH78eJ55Zh433/w73vWu99DR0cG6605mm222a96PGgCfypQkScVYddVVl3z+8IeP4O677yRiYw466IP09Lz8heNjxox5yfTyluno6KCnp4fOzlF9LttuBjNJklScuXPn8OCDD3DYYUexww5v4frrr1vh1yf1tu2223PVVVfQ09PDE0/M5Pe/v7WIsd68lClJkoozfvwE9t57Xz7wgf0ZPXo0W2+9Hc8991yflzMHY99938Pf/nYvBx10ABMnTmLddSe/pLeuXTpK7MbrxxTgvlmz5tHd3Zqau7rGMXPm0y3Zlxpjm5TJdimPbVKedrbJo48+wLrrrj+gdZo5XEYJbrzxBjo7YYcddmTevHkceuj7mTHj24wfP/Df19fx7ezsYOLENQFeC9zf6LbsMZMkSS8zXAJYf6ZMeS2f/eypTJt2LgCHH/6hQYWyoWYwW8pL/4XQ978WSjT13kPbXcKQmTTt0naXIEka5tZb75V885sXsnDh0N23NhTaEswi4kDgZGAV4GuZeU476pAkSSpJy5/KjIhXAp8DdgS2BI6MiE1bXYckSVJp2jFcxq7AtZn5ZGY+A/wXsF8b6pAkSSpKOy5lrgc80mv6EWD7Rleun3BoopXnvrLhqqtr3Ap9r/awXcpjm5SnXW3y+OOdjB7t0KV9GYrj0tnZOWRt245g1gn0Hu+iA2j4zrtWDpeh9ljW4+QOAVAm26U8tkl52tkm3d3dxd3kXoLRozuH5Lh0d3e/rG17DZcxIO2Izw8Bk3tNrws83IY6JElSP5446j19/llRRx99GFdffcVL5s2fP58993w7Tz31VJ/rHHPMkdx22y3cc89dfPGLn3nZ94888jD77bfPMvd7111/4txzvw7ADTdcx/Tp0wb5C5qrHT1mVwOnRUQX8AzwXuDINtQhSZJabK+93smVV/6KXXfdfcm86667lq233pa11lprmetuvPGmnHji4J4XvP/++5g9+0kAdtxxZ3bccedBbafZWh7MMvMfEfFp4NfAGGB6Zt7U6jr603tAvZXrUoBjf0mSyve2t+3GOeeczdy5c5YM6HrFFb9k//0P5Nprr+aHP/wuzz//PC+8sICTTjqFzTffYsm6t912Cxde+E2+8Y1v8uc/37Ok92zDDTdasszf/vYXvvrVLzF//nxmz36SD3zgEN7+9t2ZPn0a8+fP5+KLZ9DV9Qp+//tbOfXU0/nTn/7I2Wd/mQULFrDWWmtxwgmf4lWvejXHHHMkm266GXfccTtPPTWbj33sBN785rc0/fi05U7AzPx+Zr4hMzfKzDPbUYMkSWq9NdZYg5122plrr70agCeemMnf//4A22+/Az/96SWceebXuPjiH3DggQfxne9c1O92PvvZUzn66I9w4YXfY731Xrlk/s9//lMOPvgwpk//Nl//+jTOOefrjBs3jsMPP4odd3wrBx982JJlX3jhBU477VP8679+gosv/gH77vteTjvt072+X8j553+Lj3zkX7nggvOG/mD0wUc0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">
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id='Scoring-Metric:-"RMSLE"'>Scoring Metric: "RMSLE"<a class="anchor-link" href="../bikeshare%20part2/#Scoring-Metric:-%22RMSLE%22">¶</a>
</h3>
<p>Lets try to understand the metric which we will use for the Kaggle evaluation. Here is the screen shot from the Kaggle evaluation page.</p>
<p><img src="../../images/scoring.png" alt="scoring"></p>
<p>Obviously it is of great importance to understand and use the metrics properly also in machine learning. Deriving insights without making clear sense of metrics is like to choosing between 1 litre of milk and 0.6 galon of milk. If we dont know the metrics litre and galon we can't make an healty decision.</p>
<p>So we need to take into account the metric <code>Root Mean Squared Log Error(RMSLE)</code> for this project but how can we interpret this metric?</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="../../images/cost.jpg" alt="cost"></p>
<p><strong>Mechanism</strong>:</p>
<ul>
<li>It is the Root Mean Squared Error of the <strong>log-transformed predicted</strong> and <strong>log-transformed actual values</strong>. </li>
<li>
<p><code>RMSLE</code> adds <code>1</code> to both actual and predicted values before taking the natural logarithm to avoid taking the natural log of possible <code>0 (zero)</code> values.</p>
</li>
<li>
<p>As a result, the function can be used if actual or predicted have <strong>zero-valued</strong> elements. But this function is not appropriate if either is <strong>negative valued</strong></p>
</li>
</ul>
<p><strong>Functionality:</strong></p>
<ul>
<li>
<p>The expression $$ log(p_i +1) − log(a_i+1)$$ can be written as $$ log((p_i+1) / (a_i+1)) $$</p>
</li>
<li>
<p>RMSLE measures the ratio of predicted and actual.</p>
</li>
</ul>
<blockquote>
<p>RMSLE is preferable when</p>
<ul>
<li>targets having exponential growth, such as population counts, average sales of a commodity over a span of years etc </li>
<li>we care about <strong>percentage errors</strong> rather than the <strong>absolute value of errors</strong>.</li>
<li>there is a wide range in the target variables and</li>
<li>we <strong>don’t want to penalize big differences</strong> when <strong>both the predicted and the actual are big numbers</strong>.</li>
<li>we want to penalize <strong>under estimates</strong> more than <strong>over estimates</strong>.</li>
</ul>
</blockquote>
<p>Let's imagine two cases of predictions,</p>
<ul>
<li>Case-1: our model predicts the number of bike rentals as <code>30</code> when the actual number is <code>40</code> </li>
<li>
<p>Case-2: our model predicts the number of rentals as <code>300</code> when the actual number is <code>400</code></p>
</li>
<li>
<p>With RMSE the second result is scored as <code>10 times</code> more than the first result</p>
</li>
<li>Conversely, with RMSLogE two results are scored the same. </li>
<li>RMSLogE takes into account just the ratio of change</li>
</ul>
<p>The decisions always depends on the domains or business cases and for the bike rentals business and the ranges of bike rentals this <strong>"ratio of change"</strong> feature of RMSLE looks like suitable.
<br></p>
<p>Lets have a look at the below example</p>
<ul>
<li>
<p>Case-3 :</p>
<ul>
<li>
<p>Prediction = $600$, Actual = $1000$ (the absolute difference is $400$)</p>
</li>
<li>
<p>RMSE = $400$,</p>
</li>
<li>RMSLogE = $0.5108$</li>
</ul>
</li>
</ul>
<ul>
<li>
<p>Case-4 :</p>
<ul>
<li>
<p>Prediction = $1400$, Actual = $1000$ (the absolute difference is $400$)</p>
</li>
<li>
<p>RMSE = $400$,</p>
</li>
<li>RMSLogE = $0.3365$</li>
</ul>
</li>
</ul>
<ul>
<li>
<p>When the differences are the same between <strong>actual</strong> and <strong>predicted</strong> in both cases.</p>
<ul>
<li>RMSE treated them equally, however </li>
<li>RMSLogE penalized the under estimate more than over estimate (under estimated prediction score is higher than over estimated prediction score)</li>
</ul>
</li>
<li>
<p>This second feature (<strong>penalizing the under estimate more than over estimate</strong>) of RSMLE also looks plausible for bike business.</p>
</li>
<li>Having extra bikes might be preferable to not being able to supply as many bikes as the demand. </li>
<li>Often <strong>penalizing the under estimate more than over estimate</strong> is important for prediction of sales and inventory demands.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="RSMLE-Calculator-Function">RSMLE Calculator Function<a class="anchor-link" href="../bikeshare%20part2/#RSMLE-Calculator-Function">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Define the RMSLE function for error calculation: rmsle_calculator</span>
<span class="c1"># Using the vectorized numpy functions instead of loops always better for computation</span>
<span class="k">def</span> <span class="nf">rmsle_calculator</span><span class="p">(</span><span class="n">predicted</span><span class="p">,</span> <span class="n">actual</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">predicted</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">predicted</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">actual</span><span class="p">),</span> <span class="mi">2</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Custom-Scoring-Function">Custom Scoring Function<a class="anchor-link" href="../bikeshare%20part2/#Custom-Scoring-Function">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>
<p>Having defined our function for the RMSLE calculation, now we should define a scoring function in order to use as a scoring parameter for <code>model_selection.cross_val_score</code></p>
</li>
<li>
<p>We need this parameter for model-evaluation tools which rely on a scoring strategy when using cross-validation internally (such as <code>model_selection.cross_val_score</code> and <code>model_selection.GridSearchCV</code>)</p>
</li>
</ul>
<p>We will use <code>make_scorer</code> function of Sklearn to generate a callable object (from our <code>rsmle_calculator</code> function) for scoring. <br>
When defining a custom scorer via <code>sklearn.metrics.make_scorer</code>, the convention is that</p>
<ul>
<li>custom functions ending in <code>_score</code> return a value to maximize and</li>
<li>for scorers ending in <code>_loss</code> or <code>_error</code>, a value is returned to be minimized. </li>
<li>We can use this functionality by setting the <code>greater_is_better</code> parameter inside <code>make_scorer</code>. </li>
<li>This parameter would be <ul>
<li>
<code>True</code> for scorers where higher values are better, and</li>
<li>
<code>False</code> for scorers where lower values are better. (this will be our choise since the lower RSMLE values are better)</li>
</ul>
</li>
</ul>
<p><strong>NOTE:</strong></p>
<ul>
<li>If a loss, the output of the python function, is negated by the scorer object, conforming to the cross validation convention; that scorers return higher values for better models i.e</li>
<li>when <code>greater_is_better</code> is <code>False</code>, the scorer object will sign-flip the outcome of the <code>score_func</code>.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Make a custom scorer </span>
<span class="c1"># rmsle_error will negate the return value of rmsle_calculator,</span>
<span class="n">rmsle_error</span> <span class="o">=</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">rmsle_calculator</span><span class="p">,</span> <span class="n">greater_is_better</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Fit and score the model with cross-validation</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">split</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">rmsle_error</span><span class="p">)</span>
<span class="n">scores</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As explained the scores are negative due to the Sklearn customs. We can multiply the results by <code>-1</code> for our interpretation</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"The cross validation scores:"</span><span class="p">,</span> <span class="n">scores</span><span class="o">*-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The cross validation scores: [1.06115722 0.97511162 1.02056734 0.93509628 0.92447915]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Hold-out-Data-Prediction-Scores">Hold-out Data Prediction Scores<a class="anchor-link" href="../bikeshare%20part2/#Hold-out-Data-Prediction-Scores">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Hold-out target data </span>
<span class="n">y_hold</span><span class="o">=</span><span class="n">hold_out_df</span><span class="p">[</span><span class="s2">"count"</span><span class="p">]</span>

<span class="c1"># Hold-out features data</span>
<span class="n">X_hold</span><span class="o">=</span><span class="n">hold_out_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">"datetime"</span><span class="p">,</span> <span class="s2">"count"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Fit the pipeline to train data</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># Generate predictions for hold-out data</span>
<span class="n">predictions_hold</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_hold</span><span class="p">)</span>

<span class="c1"># R^2 score</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_hold</span><span class="p">,</span> <span class="n">predictions_hold</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"R^2 score of hold-out:"</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Root mean squared error of hold-out:"</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_hold</span><span class="p">,</span> <span class="n">predictions_hold</span><span class="p">)))</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">"RMSLE value for linear regression of hold-out: "</span><span class="p">,</span> <span class="n">rmsle_calculator</span><span class="p">(</span><span class="n">y_hold</span> <span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">predictions_hold</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>R^2 score of hold-out: 0.3889173616885714
Root mean squared error of hold-out: 120.48857034926871
RMSLE value for linear regression of hold-out:  0.715555147546642
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Kaggle-submission">Kaggle submission<a class="anchor-link" href="../bikeshare%20part2/#Kaggle-submission">¶</a>
</h3>
<p>Lets predict the given Kaggle test set and submit the predictions to Kaggle to get our score. <br>
First it would be better if we combine our <code>X</code> and <code>X_hold</code> and <code>y</code> and <code>y_hold</code> datasets then train our model with more data in order to let our model learn better before predicting on a new test data i.e Kaggle test dataset which we have not yet uploaded.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Combine X and X hold: combined_train</span>
<span class="n">combined_X</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">X_hold</span><span class="p">])</span>

<span class="c1"># Combine the y and y hold: combined_test</span>
<span class="n">combined_y</span> <span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">y</span><span class="p">,</span> <span class="n">y_hold</span><span class="p">])</span>

<span class="c1"># Fit the model to the combined datasets</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">combined_X</span><span class="p">,</span> <span class="n">combined_y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[17]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>Pipeline(memory=None,
     steps=[('scaler', StandardScaler(copy=True, with_mean=True, with_std=True)), ('linreg', LinearRegression(copy_X=True, fit_intercept=True, n_jobs=1, normalize=False))])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Read the Kaggle test data</span>
<span class="n">kaggle_test</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"bike_kaggle_test.csv"</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s2">"datetime"</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="s2">"datetime"</span><span class="p">)</span>
<span class="n">kaggle_test</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[18]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
      <th>season</th>
      <th>holiday</th>
      <th>workingday</th>
      <th>weather</th>
      <th>temp</th>
      <th>atemp</th>
      <th>humidity</th>
      <th>windspeed</th>
    </tr>
<tr>
<th>datetime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
</thead>
<tbody>
<tr>
<th>2011-01-20 00:00:00</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>10.66</td>
      <td>11.365</td>
      <td>56</td>
      <td>26.0027</td>
    </tr>
<tr>
<th>2011-01-20 01:00:00</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>10.66</td>
      <td>13.635</td>
      <td>56</td>
      <td>0.0000</td>
    </tr>
<tr>
<th>2011-01-20 02:00:00</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>10.66</td>
      <td>13.635</td>
      <td>56</td>
      <td>0.0000</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Lets also apply all the steps that we followed for train data to the test data in order to conform the train and test datasets</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">kaggle_test</span><span class="p">[</span><span class="s2">"month"</span><span class="p">]</span><span class="o">=</span><span class="n">kaggle_test</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span>
<span class="n">kaggle_test</span><span class="p">[</span><span class="s2">"weekday"</span><span class="p">]</span><span class="o">=</span><span class="n">kaggle_test</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">dayofweek</span>
<span class="n">kaggle_test</span><span class="p">[</span><span class="s2">"hour"</span><span class="p">]</span><span class="o">=</span><span class="n">kaggle_test</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span>

<span class="c1"># Create the sin and cos components of hour, month and weekday columns</span>
<span class="n">kaggle_test</span><span class="p">[</span><span class="s1">'hour_sin'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">kaggle_test</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">24</span><span class="p">))</span>
<span class="n">kaggle_test</span><span class="p">[</span><span class="s1">'hour_cos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">kaggle_test</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">24</span><span class="p">))</span>
<span class="n">kaggle_test</span><span class="p">[</span><span class="s1">'month_sin'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">kaggle_test</span><span class="o">.</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">12</span><span class="p">))</span>
<span class="n">kaggle_test</span><span class="p">[</span><span class="s1">'month_cos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">kaggle_test</span><span class="o">.</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">12</span><span class="p">))</span>
<span class="n">kaggle_test</span><span class="p">[</span><span class="s2">"weekday_cos"</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">kaggle_test</span><span class="o">.</span><span class="n">weekday</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">7</span><span class="p">))</span>
<span class="n">kaggle_test</span><span class="p">[</span><span class="s1">'weekday_sin'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">kaggle_test</span><span class="o">.</span><span class="n">weekday</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">7</span><span class="p">))</span>

<span class="c1"># Drop the wrong represantation of time: month, weekday, hour</span>
<span class="c1"># Drop the correlated features: atemp, season</span>
<span class="c1"># Drop the weather column (not relaible data records)</span>
<span class="n">X_kaggle_test</span><span class="o">=</span> <span class="n">kaggle_test</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">"season"</span><span class="p">,</span> <span class="s2">"month"</span><span class="p">,</span> <span class="s2">"weekday"</span><span class="p">,</span> <span class="s2">"hour"</span><span class="p">,</span> <span class="s2">"atemp"</span><span class="p">,</span> <span class="s2">"weather"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_kaggle_test</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[19]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
      <th>holiday</th>
      <th>workingday</th>
      <th>temp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>hour_sin</th>
      <th>hour_cos</th>
      <th>month_sin</th>
      <th>month_cos</th>
      <th>weekday_cos</th>
      <th>weekday_sin</th>
    </tr>
<tr>
<th>datetime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
</thead>
<tbody>
<tr>
<th>2011-01-20 00:00:00</th>
      <td>0</td>
      <td>1</td>
      <td>10.66</td>
      <td>56</td>
      <td>26.0027</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>-0.900969</td>
      <td>0.433884</td>
    </tr>
<tr>
<th>2011-01-20 01:00:00</th>
      <td>0</td>
      <td>1</td>
      <td>10.66</td>
      <td>56</td>
      <td>0.0000</td>
      <td>0.258819</td>
      <td>0.965926</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>-0.900969</td>
      <td>0.433884</td>
    </tr>
<tr>
<th>2011-01-20 02:00:00</th>
      <td>0</td>
      <td>1</td>
      <td>10.66</td>
      <td>56</td>
      <td>0.0000</td>
      <td>0.500000</td>
      <td>0.866025</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>-0.900969</td>
      <td>0.433884</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Our Kaggle test dataset is in the same structure with our <code>combined_X</code> dataset. Time to predict and submit!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">final_predictions</span><span class="o">=</span><span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_kaggle_test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Having predicted the test targets now we need to create a dataframe complying with Kaggle submission format like shown in the screenshot
<img src="data:image/png;base64,%20iVBORw0KGgoAAAANSUhEUgAAApgAAADxCAIAAADgN1AlAAActUlEQVR4nO3d7Wsb2aHH8f2P+ncMmEFggV44aUhCWEGUEFoE6V0S0/qCKMZsMJu7t7i7vYQrGu7V1ku99d2ycbVJllgsTkyrOm6eupGLBKaG2S2zL5fcF3o6Z87DnJE0ts/u9/PK0mjO0zz8NA8evfUGAAB4662TbgAAAJgcQQ4AgMcIcgAAPEaQAwDgMYIcAACPEeQAAHiMIAcAwGMEOQAAHiPIAQDwGEEOAIDHCHIAADxGkAMA4LGMQf7XX/7oLdnZjyep9uOz08z9faaO8NSDDQD4HssQ5MPwVf3ol3/NWG3eQT4sP3vLjqc8M4IcAJCFc5CPYlzIsnG0Zw04gtxkFOR+hvZgoPxsPAD4yDHIR/GSSLJJY4dT6yYEOQAgi6xBPqM9NEFu4neQD1vvZeMBwEtZgzz15PLwk9LnlNwW3xCvCsulC5+SLh2PPiVetpeyQ/tFIXH5OdkT22TDFw97icJQyB+0jaFzkLvVLQxw/xOTj2lyYuIDulso8r8SAQA/eK7XyJP3YBl30RmD/Ky6+x+Hw+jK9I+UG8DOfqy5K0ydU33H0AvHyUJwGe5KE/o9Ggq1+eaYdgpy97rP/jLxFWzyMU2plCAHgBMxi7vWtYe9bkGufU9zcDh6S0wTdU7tEb+2VfIHUiZrOqDeNGB5x9rUBMtd68OCM9Ytzz7xmCr3++m+cmiXPgAgR1kfCJN6LJgxyLUnxJMHeWJZ2iNW66l74bUpX1ImO3wx0DXN2lRTXelBnq1u0+WK7GNqbKruJARBDgDHZKonu+kup2a/Rj6WDBTdpyYrX4lHQ8X6yUp5hvPfiZC0Jm5qkKcesjvVndYTc5v0iyjlBDpBDgDHbdpHtCondacJ8uTbswty05GueqpcP9nbIFeqmX5MFQQ5AJwgtyC3nA9OTjqdR+SaOvQ9MkwmyMcxrnz5IcgB4AS5Bfk43pLxosSKbleuZo/9GrnxFjND+VmCPFmO4ROJyaaWWTM6nyCfom5dT4wfTrkdUN8QghwAjpvrqXX901g1h2lqRltv3s5077lYWqYgVyNHKiZlsq6CLHeOzzjIJ697mjFVxki7Rvj9OBsA8JH7NXLzb6YY7osWpp89mzj8dSssx5vd3pKmp0ye9v/IZxzkE9c91ZhqFtn4f9FN9xqQ5wCQt4w3u6l7c92uWnlkmHIeW0gJqUj9dd/ZnFpPeaaNdbLbk90MU2cf5BPWnTYyaV1WF5WuNOuj4QAAMzbtXesAAOAEEeQAAHiMIAcAwGMEOQAAHiPIAQDwGEEOAIDHCHIAADxGkAMA4DGCHAAAjxHkAAB4jCAHAMBjBDkAAB4jyAEA8BhBDgCAxwhyAAA8RpADAOAxghwAAI8R5AAAeIwgBwDAYwQ5AAAeI8gBAPAYQQ4AgMcIcgAAPEaQAwDgMYIcAACPOQR5a2Vubu5KoyO92WlcUd88Vp3GlbmV1pQFZO/BZHNptVbm5jRD++ZNa+Vkh9Zu6oGfnXyacrIdzLDwZ9hQc1GG9pzudTR/5mGZapFMN6yDPYq1BeKSns1CnLbPok7jimGnCCunI/JO44q8qGaYZhM7RXkyEXkMpVenYidpbMQpGniC/PsU5DMuMt/FOKvGJlo5VbFOiTr7IJ+hEwmWU7RDm5zjqXU5ymf5FWxivg+/ZZ09FdsXQX4yCPIZ+UEGefrMpz7Ij33TO0U7tMk5XyMf544c48NzIdLpEHlolFWn1biiPf8zPDM0J39pENY14VW/1HH140+1VuauNBorUrNGRZsPgpWqtX1L5K92Pl0DjD0dj6rhiLxlKyhbd/XLRO2E2DxlOSUHXpwuzDioOXk2R1h70jomjr9+S7M1RZjZ3sLE+/3VM9Fi/WBqLzqZmt1pXJlbaegbJfbAtHPVrGmO3ddvP280W1OG9vTfHjdKWj6pS9ZhjUsOsWX9VUdcfEOzgWm6Li1LQ/vdhmXYLtsCV5sttVKz+aaNqm6TNe7U9EGuflzeeBOXU1srws5GKtGw6xNWloYmOzWjYVuLhRBx3AMad0+J91or2qV1umW42a2/vOQgSyxDaR02rTqmUdLPb93+5qRX0maY2CaFVVszi7bqRJHCktdVam2AbpNXvxHogtxURWLcHLurXSaG5WY9ItfndKKk8eAmvmR1nDqWHFHNSuPUlOR3B7WFyjjJWalpprzyOTVbKldsq9Ju00LWrqGZuu8U5E7tSWzIyY7al6zTGpccYvs+RfxbGBDjsa5xR2Jf5E7DIo6jPhIFaitT91bGk3lSF207Ks2IGz6e2C3N6fYnyfHXblbJv11Gw7IWS/M77gENG79yRP59D/LkklRWqPFLt41OlhzOTkeNAdOaJ0+S61BeqQXoq04k2aA9+viXX9oaIPU3NcjVfZt1t5jWXd0yMYy7Pci168BwzmR1QkmjPx06JhWnb42pKZq9Y/9ATd9C44I0NtO0K7U029bW1GWsX0jZi3QIcqf2KGMmDWbK7G5rXHJO2/pr/EblGuSGDVGYmH1YjNtJSiu1G7PLjkBJXW25+iC37cvGH1lptVbUYkx5a94lGmNAbJx1LVaSN30PaNo9Keujl7L9+5l1rUscbrmczFEKV04EOR1DJF4bZ1ELkA6wNFWrp2fMO3NLAyYNcqFd2pNV9g7axit5BKZ03h7kckHy7mpMWejZOiYuAf0HTE2R5pPbommheUEam2nf9rXNtrU1fdy1Cyl7kQ5rh1t7lLeHr12WrNMaZ96+7e01zJBlw9C1331YdCcbsgS5btfhtr1YDnP0X9yl7THl4/3PJl4m+2xrv/lbmX40XNdi5z2gafdEkBu/GU0U5GIp4xX1WIJcX7VQ8Hi524Ncd7g5ZZCnDdfUQW7ofPYgb62Yto5BWcK34/SOdRpX5jRD4tQU085d30L7XszlaM+l2dMFudQD/dcJa5Fpm8ZMgzx1ldV15hQFeUpCa4rTfWzWQZ4+qilBrq401iAXNtWV1ptO48po+a60jAf/+Qa5di123QMad08Euebkh/qtz7agHSpSvlGZVlWHw4431nVd38fkfOYzPJYGTBrk5r2Urmnp3TWdf9J1PnOQyx2SK2itzF1pNAwbv7Fb4084LSvzdyxtKdKOwfD91NRM87ZvbLZjWx2/4hi+LxuL1C1Ufesc25MYGYdgTelMtiAf1+L6Zcuh67qOvdHMYak1pyB3G1VTukqT9IdVxo8PZmgMcvxNP9HFTdklyC2bmHE0HNdiXaW6V+bdE0HeP/zQfIMS3+8f0KYHeXJohTVM+MqevClJnKT/Zu8Q5NqqpQWv32+IlSben1GQS1XIL97o5kzprm6ZGMbd9UhHjg8xAJU9w5UriVGxdkx4T17UDk2RV8zRC2MLlZVMWqk1zbQHubbZTm019VS/kNy6n9jPmrcm48ZrSizt9u62ZNPXONu+Rtqn6Je1bgNL7bqt/e7DkjnIbZuvbhU17AjkmU07J32QGz8+HC15+SZvIk8NcssmlhwN6WuwaS2eLMj1uyfNIWGm76KnwnRB/ma4TivXu8S3G/pVR1u65grQYD2am5MP6oZfFNXaJzgi11c9rtm41MXGpW+Nyd6mB7ncCu3a5dhd8zIxjPvw7eTyMu+gxgVd6V9NS2yUiZIcOjaerN132faVQq90byZaKE4w/vuZ3B3Tpm5otq2t4iyGLUS3kBy7LzXUtjW11A/Z//3M9C+WaUvWZY1Th9i0/srlaZactPtO6bqt/W7Dki3IE6207TrSRlUXcPpBNseubmkmky0ZdE5BLi6k/v8+pQb5G9NaPFGQ23ZP8oryAwhyAACm8r04m32qEOQAgDzJJ9SMl+0wKYIcAJAz8UKl8fIqJkSQAwDgMYIcAACPEeQAAHiMIAcAwGMEOQAAHiPIAQDwGEEOAIDHCHIAADxGkAMA4DGCHAAAjxHkAAB4jCAHAMBjBDkAAB4jyAEA8BhBDgCAxwhyAAA8RpADAOAxghwAAI8R5AAAeIwgBwDAY65B/t1333377bfffPPN1wAA4NRwCvLvvvvum2+++de//hUDAIDTxCnIv/32W1IcAIBTyCnISXEAAE4npyD/+uuvT7qdAABAgyAHAMBjBDkAAB4jyAEA8BhBDgCAxwhyAAA8RpADAOAxghwAAI8R5AAAeIwgBwDAYwQ5AAAeI8gBAPAYQQ4AgMcIcgAAPEaQAwDgMYIcAACPEeQAAHiMIAcAwGPHFOT79XJQa86kxVkc3vtFGP7i3uGxVwwAwPE4bUG+Xy8H5fp+lrKbteAkviQcowkGBQDwA0GQe4AgBwCY5Bjk0d76zXOFIAjnL797Z+XSOGy7O/Wb5wpBEASFczfrO93B281akDCO5+jF1ruX58MgCOcv3Fzfi/rv7tfLiTmGcSdOEUJ+v14OytffWQiDwrl3P7j9diEI53/6v/vWSqxd7Dy8fbVUCIKgcK76wcPOaBapqEb7SOjiuDnCt5v9ejmofdZuDAfs9qNu+qAAAJBfkB8+WC6FlbXtl73eweM7lXCUQK/Wq2FpcaPdOzw8eHy3WgwX/yhcw9YefHabtVJpcaN90Ou93F6rhKXlB8IstiPyxLT9ejko/2b34OXHN8L+Hx/9LDiztpteiU60u3Y+OH/r82e9Xq+9sVgaNbzbrA37/nJ7rRKG1fVXmuYkgjyc/+mHo+GSRoUjcgCASV5Bfrh5IyjeejQ8RN27MzoiP+q9ft0bHqLGzVoQLj8Yz6fLrL98eD64sTnKtd21M8HS1vh4OWOQ15riH6MPpFSiETVrodDFw63lH//b757HcdxZrwbnP/zL8HOvGteGL61BfunO3rDkraWguNqyDgoAAHGcX5Dv18tiLorXyKPOl43a1YX5UHeyWJdZ6ull6SOzCfKUSgxd1H4k2aDxtxhrkAtl6U4kEOQAAI3jD/L9ejkoXa9vP3v9+vXr15/83CnIL/xn67Xo4HDWR+QplRi6SJADAE5WbqfW/7gYak+tP79bEUIp2lqSQ6+zXlUya3ftjPReFEkB21otziDIUyrRSJxaj3Z/t/Jf9zux7dT63p1Lwgl74XqDPch1gwIAQBzneLNb1Fod3+x2t1ocJVNrtRiU399+2esdtDeWFsLE4XRrtRiUf/O4d3h48Pplp39I/2q9GoYXlz9r93q9Z9v166W3//vpeI7OejUoLv3fy8PD3utnX3VjkXuQp1SiO+zv3+xW+6zd6/Xany1fLFTuam52u1Mtjm52ix7dKobV/+lXsSbcAWgPcu2gAAAQn8i/nw3/+yycv3Cz/tF/XP3xv3/6D2G27qPbl+fDIAgKpZ999Gzw5tGzz94dvnv13a0Xka6iIJy/8N4Xh3Gs+8e0oNa0B7m9Ev35e/Hfz4R/pDP++9m4d+H85duN9x1PrRsGBQAAnrXuhpPbAIDTiSB38Y9Pb55L/bdyAACOH0EOAIDHCHIAADxGkAMA4DGCHAAAjxHkAAB4jCAHAMBjBDkAAB4jyAEA8Fh+Qd7dqd+8MHgaae0Pe8LzTqXnl67vKT9OcvTVk43mnzVFGidopFQSHT69v9nquJY0fA5r9YNH3cQkW0+yNGv45NqgULp6+1HXXER6WdmbZa59hs0CAOQgryB/tV4NS4sb7YNe7+X2WiUsjR6Mlvw1lfGU+OirJxu3f7IQBsnnmhsnmJgriQ6f3q/X3i6k/964XNKzXq/X3lgshcNfRrH2JHOzhuPV6/WefX7rvFBL5rKyN8tc+wybBQDIRU5B/vxuJbjWeDV4FW0tBeHyg/6LB8vij3/urp0Z/W75fr0yf7lWv//bxG+UmycYmStp1grnqrc3Pn3vkluQyyXt3bkUVO4+T6skc7Pk8TrcvBGcWdudsIvZm2WsfZbNAgDkIqcg7+z+6d7jv49eNmujIJd/56u78355FA7DnwBXfvvLOMEkvZLEz40Z/fNv2/e+2Bsl0X69PApySyWZmyX1LHqxcaOYyL/O76+HQWm1FaWWld6sL2+XgtEvq1prT21Whi4CAHJxHDe7dbeWiqOjtPGePnqxubQwXygo4WzM6wmC3FSJa5BLor075fERqkNPnJs17ll358Nr84VCmGhd55N3CuHCbV2QJ8pKb9aXv1oIC9d/rwvyRO2pzcrQRQBALvIP8m6zVhKO//p7+r3Ow9WLhYurDztbajjPKshtlUwQ5NFevRIKB8UOPXFuVr9nR+3G9VLpeqPdTm+dsazszTLXPsNmAQDykXOQ98Ov1hzf7bxfLwfFhYVCaXHzRRRrwzlDkDdrgWiYMumVqEG+Xy9LZSVa0G3WSmGlLtyE7dCTBPMczVoQlBYWCpW1na62de5lZW+WufYZNgsAkI9cg1wNv/6ePhwEQxzHcbOmXETNEORHvdeig8Px+Xt7JWomRYcHUlm9I2Ga8n3ErScJ5jmatSAYZt/ggw4Xo7VlZW+WufYZNgsAkI/8glwbfnEct1aLxdXW8JUuG6Y/tZ5eSZZT67rvI06VuDers14NquvDf2uPmrUwNf6MZWVvlrH2WTYLAJCLvILcFH5xHO2unR/+o3F7Y7FUrDUTO/oZBHlqJc5Bbvo+4tQT9zm6mzdG/7C9vVYJk21T7lo3l5XaLOWudXPt9mbpBjH7oAAAppFXkCcuXosXsOVHfzXaR7p5pwzy1Eqcgzx56Vy6fJ7WkyzNkh6h9rCT+Aak3LVuKyulWcpd67babc3SD2L2QQEATI5nrWNirdViWGvyDFYAOEkEOSb15NcXrqU+shUAkC+CHAAAjxHkAAB4jCAHAMBjBDkAAB4jyAEA8BhBDgCAxwhyAAA8RpADAOCx/IK8u1O/eaH/pM7LtT+ID12XnuG5rj6O/eirJxvNP2uKNE7QSKkkOnx6f7PV0c6qKelqqRAEQeFc9YNH3cQkW08yN2s2XczeLPlJrGIfjROyNwsAkIO8gvzVejUsLW60D3q9l9trlbC0/GDw2xlRa7U0/FWNx3erxfGU+OirJxu3f7IQKr8GbpxgYq4kOnx6v157uyA+/N2lpGe9Xq+9sVgKK6OHmVl6krlZM+xi9maNllav13v2+a3z4z4aJ0zSRQBADnIK8ud3K8G1xvBnOaKtpSBcftB/8WA5LN56NDxO2107M/qdy/16Zf5yrX7/tz9PhJlxgpG5kmatcK56e+PT9y65Bblc0t6dS0Hl7vO0SrI3a4ZdzN4seWkdbt4Y/oa4ccIkXQQA5CGnIO/s/une47+PXjZroyCXfzGru/N+eRQOURQNPy2HmXGCSXolrr9+9s+/bd/7Ym+URPv18ijILZVM3CxjF5WfMTWWld4s5WdMpUqjFxs3ioP0NU6YpIsAgDwcx81u3a2l4ugobbynj15sLi3MFwpKck3/M6bplTj/jKko2rtTHh+hOvQkc7PMQZ78GVNjWemVKD9jOq60u/PhtflCIRyUYJwwTRcBALOUf5B3m7WScPzX39PvdR6uXixcXH3Y2VKTa1ZBbqtkgiCP9uqVUDgoduhJ5mbNoIvZmzWo9KjduF4qXW+026OxMU6YposAgFnKOcj74Vdrju923q+Xg+LCQqG0uPkiirXJlSHIm7VANEyZ9ErUIN+vl6WyEi3oNmulsFIXbsJ26EnCNH13Lit7s+JmLQhKCwuFytpONxbHxjhhmi4CAGYp1yBXw6+/pw8HwRDHcdysKRdRMwT5Ue+16OBwfP7eXomaSdHhgVRW70iYpnwfcetJwjR9dy4re7P6eT1I3kEJ42vk2gnTdBEAMEv5Bbk2/OI4bq0Wi6ut4StdNkx/aj29kiyn1nXfR5wqyd6sWXQxe7M669Wguj78p/qoWQsH4WucMEGzAAC5yCvITeEXx9Hu2vnhPxq3NxZLxVozsaOfQZCnVuIc5KbvI049yT6H813r5rJSK1HuWo+7mzdG/y6+vVYJRyNjnBDHsX4Qsw8KAGAaeQV54uK1eAFbfvRXo32km3fKIE+txDnIk5fOpcvnaT3J3Cz3u9ZtZaVUoty1Hice4PawE6VPiE2DmH1QAACT41nrmFhrtRjWmjyDFQBOEkGOST359YVrqY9sBQDkiyAHAMBjBDkAAB4jyAEA8BhBDgCAxwhyAAA8RpADAOAxghwAAI8R5AAAeCy/IO/u1G9e6D+p83LtD+JD16VneK6rj2M/+urJRvPPmiKNEzRSKokOn97fbHW0s2pKuloqBEFQOFf94FE3McnWE/dmWSrJ3sXszZKfxCpWb5yQvVkAgBzkFeSv1qthaXGjfdDrvdxeq4Sl5QeD386IWqul4a9qPL5bLY6nxEdfPdm4/ZOFUPk1cOMEE3Ml0eHT+/Xa2wXx4e8uJT3r9XrtjcVSWBk9zMzSk4zNslSSvYvZmzVaWr1e79nnt86PqzdOyN4sAEAucgry53crwbXG8Gc5oq2lIFx+0H/xYDks3no0PE7bXTsz+p3L/Xpl/nKtfv+3P0/ktXGCkbmSZq1wrnp749P3LrkFuVzS3p1LQeXu87RKsjbLUkn2LmZvlry0DjdvDH9D3DhhgmYBAHKRU5B3dv907/HfRy+btVGQy7+Y1d15vzwKhyiKhp+W89o4wSS9EtdfP/vn37bvfbE3SqL9enmUsZZKMjbLUsmQ8jOmxtrTm6X8jKk0rtGLjRvFQfoaJ2TuIgAgJ8dxs1t3a6k4Okob7+mjF5tLC/OFghLO0/+MaXolzj9jKor27pTHR6gOPcncLKWSIeVnTI1lpVei/IzpeFy7Ox9emy8UwkEJxgnTdREAMDv5B3m3WSsJx3/9Pf1e5+HqxcLF1YedLTWcZxXktkomCPJor14JhYNih55kbpZSSfaysjdrMK5H7cb1Uul6o90ejY1xwjRdBADMUs5B3s+lWnN8t/N+vRwUFxYKpcXNF1GsDecMQd6sBaJhyqRXogb5fr0slZVoQbdZK4WVunATtkNPElLnUCvJXlb2ZsXNWhCUFhYKlbWdrjQ2xgmTdxEAMFu5Brkul/br5SAcBEMcx3GzplxEzRDkR73XooPD8fl7eyVqJkWHB1JZvSNhmvJ9xK0nCfY5tJVkLyt7s/p5PUjeQQnja+TaCRN2EQAwc/kFuSmXWqvF4mpr+EqXDdOfWk+vJMupddNxcnpPMjQrw8F4SlnZm9VZrwbV9eE/1UfNWjgIX+OECZoFAMhFXkFuzqVod+388B+N2xuLpWKtmdjRzyDIUytxDnLLcXJ6T1znSD8YV+5aN9ee2izlrvW4u3lj9O/i22uVcDQyxglxHOsHMfugAACmkVeQJy5eixew5Ud/NdpHunmnDPLUSpyDPHnpXLp8ntYT12ZZK4njWHPXuq32lGYpd63HiQe4PexE6RNi0yBmHxQAwOR41jom1lothrUmz2AFgJNEkGNST3594Vr6o2QBALkiyAEA8BhBDgCAxwhyAAA8RpADAOAxghwAAI8R5AAAeIwgBwDAYwQ5AAAeI8gBAPAYQQ4AgMcIcgAAPEaQAwDgMYIcAACPEeQAAHiMIAcAwGMEOQAAHiPIAQDwWM5BHrVWS0HhnU86zhPiV+vVMFz41ZcT1ggAwA8JQQ4AgMc4tQ4AgMcIcgAAPEaQAwDgMYIcAACPEeQAAHiMIAcAwGMEOQAAHiPIAQDwGEEOAIDHCHIAADxGkAMA4DGCHAAAjxHkAAB4jCAHAMBjBDkAAB4jyAEA8BhBDgCAxwhyAAA8RpADAOCxnIM8aq2WgsI7n3ScJ8Sv1qthuPCrLyesEQCAHxKCHAAAj3FqHQAAjxHkAAB4jCAHAMBjBDkAAB4jyAEA8BhBDgCAxwhyAAA8RpADAOAxghwAAI8R5AAAeIwgBwDAYwQ5AAAeI8gBAPAYQQ4AgMcIcgAAPPb/AIAYWyVo6mEAAAAASUVORK5CYII=" alt="resim.png"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">kaggle_sub</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"datetime"</span><span class="p">:</span><span class="n">kaggle_test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s2">"count"</span><span class="p">:</span><span class="n">final_predictions</span><span class="p">})</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">"datetime"</span><span class="p">)</span>
<span class="n">kaggle_sub</span><span class="p">[</span><span class="s2">"count"</span><span class="p">]</span><span class="o">=</span><span class="n">kaggle_sub</span><span class="p">[</span><span class="s2">"count"</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
<span class="n">kaggle_sub</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[21]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
      <th>count</th>
    </tr>
<tr>
<th>datetime</th>
      <th></th>
    </tr>
</thead>
<tbody>
<tr>
<th>2011-01-20 00:00:00</th>
      <td>29.463588</td>
    </tr>
<tr>
<th>2011-01-20 01:00:00</th>
      <td>32.955071</td>
    </tr>
<tr>
<th>2011-01-20 02:00:00</th>
      <td>22.045803</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Save the submission dataframe</span>
<span class="n">kaggle_sub</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"kaggle_sub.csv"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Kaggle-Submission-Score">Kaggle Submission Score<a class="anchor-link" href="../bikeshare%20part2/#Kaggle-Submission-Score">¶</a>
</h3>
<p>When we fit our model to the Kaggle test set and submited we got the score below. This competition is closed so there is no ranking anymore but to get a bit of idea about our model's performance the mean ranking and the two scores in the ranking that our score fall in between were below. 
<br></p>
<p>For the start of our project this is a pretty good score.</p>
<ul>
<li>We have just tried Linear Regression so far and also </li>
<li>we did not used new features except from the time features. </li>
<li>Later we can work more on this and i think our ranking can get better</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Our score:
<img src="../../images/kaggle1.jpg" alt="kaggle1"></p>
<p>Mean value benchmark:</p>
<p><img src="../../images/kaggle2.jpg" alt="kaggle2"></p>
<p>The ranking that our score falls in</p>
<p><img src="../../images/kaggle3.jpg" alt="kaggle3"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Wrap-Up">Wrap Up<a class="anchor-link" href="../bikeshare%20part2/#Wrap-Up">¶</a>
</h3>
<p>This was the second part of our analysis on bikeshare dataset <br></p>
<p>In this notebook we</p>
<ul>
<li>continued to prepare our dataset for machine learning</li>
<li>used the trigonometric function for time data transformation in order to better represent the cyclic nature of time features</li>
<li>splitted our data set and keep an hould-out test set for final evaluation</li>
<li>used <code>TimeSeriesSplit</code> iterators for the cross validation of timeseries data. This was important in order to only using past data to evaluate our model on the “future” observations </li>
<li>used Sklearn Pipeline for better workflow</li>
<li>understood the mechanism and the functionality of the RSMLE metric</li>
<li>created a custom scoring function which uses RSMLE for the sklearn model evaluation tools </li>
<li>prepared and predicted the Kaggle testset and made a submission</li>
</ul>
<p>In the next post we will continue our analysis of bikeshare data with tree-based models and focus on model performance especially with visualization tools</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Sources:<br><a href="https://scikit-learn.org/stable/modules/model_evaluation.html#defining-your-scoring-strategy-from-metric-functions">https://scikit-learn.org/stable/modules/model_evaluation.html#defining-your-scoring-strategy-from-metric-functions</a><br><a href="http://blog.davidkaleko.com/feature-engineering-cyclical-features.html">http://blog.davidkaleko.com/feature-engineering-cyclical-features.html</a> <br><a href="https://www.quora.com/What-is-the-difference-between-an-RMSE-and-RMSLE-logarithmic-error-and-does-a-high-RMSE-imply-low-RMSLE">https://www.quora.com/What-is-the-difference-between-an-RMSE-and-RMSLE-logarithmic-error-and-does-a-high-RMSE-imply-low-RMSLE</a></p>

</div>
</div>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../bikeshare/" rel="prev" title="Feature Selection by Visualization">Previous post</a>
            </li>
            <li class="next">
                <a href="../tree-based%20models/" rel="next" title="Tree-based Models">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        


        </section><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha256-SDRP1VVYu+tgAGKhddBSl5+ezofHKZeI+OzxakbIe/Y=" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'center', // Change this to 'left' if you want left-aligned equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script></article><footer id="footer"><p>Contents © 2018         <a href="mailto:n.tesla@example.com">Harun</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    </section><script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(2, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
