
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>We continue our analysis of <code>bikeshare</code> dataset.</li>
<li>In this part we will do machine learning steps in order to predict the bike rentals for the given Kaggle testset and submit it.</li>
</ul>
<p><img src="img_bike2/timecycle.png" alt="time"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/images/kaggle1.png" alt="kaggle1"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>.. image:: /images/kaggle1.png</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<!-- TEASER_END -->
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/images/kaggle1.png"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Import the necessary modules</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">partial</span> 

<span class="c1"># Import the acf module from statsmodels.tsa.stattools</span>
<span class="c1"># `tsa` stands for `time series analysis`</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="k">import</span> <span class="n">acf</span>
<span class="c1"># Import the plot_acf module from statsmodels</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="k">import</span> <span class="n">plot_acf</span>


<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="k">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">TimeSeriesSplit</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <span class="n">Ridge</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="k">import</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="k">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="k">import</span> <span class="n">make_scorer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="k">import</span> <span class="n">Pipeline</span>

<span class="kn">from</span> <span class="nn">yellowbrick.regressor</span> <span class="k">import</span> <span class="n">ResidualsPlot</span>

<span class="kn">import</span> <span class="nn">warnings</span> 
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>In previous post, we prepared the dataset partially </li>
<li>We created new columns and dropped the outliers regarding the <code>"count"</code> column </li>
<li>Now we start by loading the dataset and continue to prepare it before applying machine learning algorithms</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Let's-remind-our-dataset">Let's remind our dataset<a class="anchor-link" href="#Let's-remind-our-dataset">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Kaggle-terms-for-the-dataset:">Kaggle terms for the dataset:<a class="anchor-link" href="#Kaggle-terms-for-the-dataset:">&#182;</a></h4><ul>
<li><p>The training set is comprised of the first <code>19 days</code> of each month, while the test set comprised of the days from <code>20th</code>  to the end of the month for each month.</p>
</li>
<li><p>Predict the <code>total count of bikes rented during each hour</code> covered by the test set, using only <code>information available prior to the rental period</code>.</p>
</li>
</ul>
<p>Here is the <a href="https://www.kaggle.com/c/bike-sharing-demand/data">Kaggle link for the dataset</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Read the bike_data_inliers</span>
<span class="n">bike_data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;bike_data_inliers.csv&quot;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">)</span>
<span class="n">bike_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[24]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>holiday</th>
      <th>workingday</th>
      <th>weather</th>
      <th>temp</th>
      <th>atemp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>casual</th>
      <th>registered</th>
      <th>count</th>
      <th>month</th>
      <th>weekday</th>
      <th>hour</th>
    </tr>
    <tr>
      <th>datetime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01 00:00:00</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>81</td>
      <td>0.0</td>
      <td>3</td>
      <td>13</td>
      <td>16</td>
      <td>1</td>
      <td>5</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2011-01-01 01:00:00</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.02</td>
      <td>13.635</td>
      <td>80</td>
      <td>0.0</td>
      <td>8</td>
      <td>32</td>
      <td>40</td>
      <td>1</td>
      <td>5</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2011-01-01 02:00:00</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.02</td>
      <td>13.635</td>
      <td>80</td>
      <td>0.0</td>
      <td>5</td>
      <td>27</td>
      <td>32</td>
      <td>1</td>
      <td>5</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">## Filter out the casual and registered columns and </span>
<span class="c1">## high correlated columns &quot;season&quot; and &quot;atemp&quot;  should be omitted</span>
<span class="c1">## Also in the previous post we noticed that the data record in the &quot;weather&quot; column is not relaible</span>
<span class="c1">## We will also drop it</span>
<span class="n">bike_data</span><span class="o">=</span> <span class="n">bike_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;casual&quot;</span><span class="p">,</span> <span class="s2">&quot;registered&quot;</span><span class="p">,</span> <span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;atemp&quot;</span><span class="p">,</span> <span class="s2">&quot;weather&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">bike_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[25]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>holiday</th>
      <th>workingday</th>
      <th>temp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>count</th>
      <th>month</th>
      <th>weekday</th>
      <th>hour</th>
    </tr>
    <tr>
      <th>datetime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01 00:00:00</th>
      <td>0</td>
      <td>0</td>
      <td>9.84</td>
      <td>81</td>
      <td>0.0</td>
      <td>16</td>
      <td>1</td>
      <td>5</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2011-01-01 01:00:00</th>
      <td>0</td>
      <td>0</td>
      <td>9.02</td>
      <td>80</td>
      <td>0.0</td>
      <td>40</td>
      <td>1</td>
      <td>5</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2011-01-01 02:00:00</th>
      <td>0</td>
      <td>0</td>
      <td>9.02</td>
      <td>80</td>
      <td>0.0</td>
      <td>32</td>
      <td>1</td>
      <td>5</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="About-Time-Data">About Time Data<a class="anchor-link" href="#About-Time-Data">&#182;</a></h2><ul>
<li>Since our data is a timeseries, i.e data recorded with a time dimension, we need to take into account the timeseries practices.</li>
</ul>
<ul>
<li>Firstly, we need to be aware of the <code>cyclic</code> nature of our timeseries dataset</li>
</ul>
<ul>
<li>As we walked through the time frame charts in the previous post, we saw that <code>month</code>  and <code>hour</code> variables are very predictive over the number of bike rentals. </li>
</ul>
<ul>
<li>This is very resaonable as we might expect that the bike usage and rentals during <code>January</code> is less than <code>May</code> and rentals at <code>3am</code> in the morning is less than at <code>14h</code>, during the day. </li>
</ul>
<ul>
<li><p>So we should use the <code>"month"</code> and <code>"hour"</code> data as features for our models. However, we have a problem of how to utilize these features.</p>
</li>
<li><p>We need to keep them <code>numeric</code> for the machine learning algorithms but if we use them without any transformation, it would not be so smart practice.</p>
</li>
</ul>
<p>To make it clearer here is a question:</p>
<ul>
<li>Which one would you expect is more similar to the bike rentals in <code>January</code>: rentals in <code>December</code> or rentals in <code>May</code>? </li>
</ul>
<ul>
<li><p>Regarding the seasonal affects we can tell that number of bike rentals <code>December</code> is more similar to rentals in <code>January</code>, however we represent <code>December</code> with number <code>12</code> and <code>May</code> with number <code>5</code>.</p>
</li>
<li><p>This is a wrong representation of the time features especially for the algorithms that use distance or the algorithms like linear regression.</p>
</li>
</ul>
<blockquote><p>As an example let's assume our model is $$ bikerentals= 5+ θ*hour $$<br>
At 0h the number of estimated rentals = 5 <br>
At 23h the number of estimated rentals= 28 <br>
Even though there is only 1 hour difference between 0h-23h with this represantation the difference is the largest</p>
</blockquote>
<ul>
<li>Because of the cyclic nature of the months and hours we need to find a way of representing these features such that    <ul>
<li>the <code>12th</code> month should be closer to <code>1st</code> month than <code>5th</code> month or </li>
<li><code>23th</code> hour should be closer to <code>1st</code> hour than <code>7th hour</code>. </li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Representation-of-the-cyclic-time-features">Representation of the <code>cyclic time features</code><a class="anchor-link" href="#Representation-of-the-cyclic-time-features">&#182;</a></h2><ul>
<li><p>We map each cyclical variable onto a circle such that the <code>lowest value</code> for that variable appears right next to the <code>largest value</code>.</p>
</li>
<li><p>We compute the <code>x</code> and <code>y</code> component of that point using <code>sin</code> and <code>cos</code> functions.</p>
</li>
</ul>
<p><img src="data:image/png;base64, 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" alt="resim.png"></p>
<p>Note that when we perform this transformation for the <code>"month"</code> variable, we also shift the values down by one such that it extends from <code>0 to 11</code>, for convenience</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Create the sin and cos components of hour, month and weekday columns</span>
<span class="n">bike_data</span><span class="p">[</span><span class="s1">&#39;hour_sin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">bike_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">24</span><span class="p">))</span>
<span class="n">bike_data</span><span class="p">[</span><span class="s1">&#39;hour_cos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">bike_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">24</span><span class="p">))</span>
<span class="n">bike_data</span><span class="p">[</span><span class="s1">&#39;month_sin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">bike_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">12</span><span class="p">))</span>
<span class="n">bike_data</span><span class="p">[</span><span class="s1">&#39;month_cos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">bike_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">12</span><span class="p">))</span>
<span class="n">bike_data</span><span class="p">[</span><span class="s2">&quot;weekday_cos&quot;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">bike_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">weekday</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">7</span><span class="p">))</span>
<span class="n">bike_data</span><span class="p">[</span><span class="s1">&#39;weekday_sin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">bike_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">weekday</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">7</span><span class="p">))</span>

<span class="c1"># We can drop the columns &quot;month&quot;, &quot;weekday&quot; and &quot;hour&quot;</span>
<span class="n">bike_data</span><span class="o">=</span><span class="n">bike_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="s2">&quot;weekday&quot;</span><span class="p">,</span> <span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Split-the-data">Split the data<a class="anchor-link" href="#Split-the-data">&#182;</a></h2><p>Even though there is a given test set (without target variable) for Kaggle submission we will analyse the data as an independent project.</p>
<p>So, after fitting a model we will use <strong>cross validation</strong> for evaluating model performance and hyperparameter tuning but we still we need to keep an <code>hold-out set</code> for our final evaluation.</p>
<p>Since this is a timeseries dataset we must to respect the temporal order of the data. Thus, we must use only the past data to predict the future data. So we can take the <code>last %5</code> as our hold-out data. (In the Kaggle competition the test set is the last 10 days of the months)</p>
<ul>
<li>We need to split the data before doing transformation (incase we do) because test data points represent real-world data. </li>
<li>Transformation of the variables use information from the dataset like <strong>mean</strong> and <strong>standard deviation</strong></li>
<li><p>If we transform the data before splitting we take information like mean and variance of the whole dataset thus we will be <strong>introducing future information to the training data</strong>.</p>
</li>
<li><p>Therefore, we should perform transformation over the training data. Then perform the same transformation on testing data as well, but this time using the parameters (like mean and variance) of the training data.</p>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[27]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Find the starting indice of the last five percent</span>
<span class="n">last_five_percent_ind</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bike_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">())</span><span class="o">*</span> <span class="mf">0.95</span><span class="p">)</span>

<span class="c1"># Create the hold-out dataset</span>
<span class="n">hold_out_df</span><span class="o">=</span><span class="n">bike_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">last_five_percent_ind</span><span class="p">:</span> <span class="p">,:]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The shape of the hold-out dataset:&quot;</span><span class="p">,</span> <span class="n">hold_out_df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">hold_out_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The shape of the hold-out dataset: (522, 13)
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[27]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
      <th>holiday</th>
      <th>workingday</th>
      <th>temp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>count</th>
      <th>hour_sin</th>
      <th>hour_cos</th>
      <th>month_sin</th>
      <th>month_cos</th>
      <th>weekday_cos</th>
      <th>weekday_sin</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>9914</th>
      <td>2012-11-16 06:00:00</td>
      <td>0</td>
      <td>1</td>
      <td>12.30</td>
      <td>61</td>
      <td>6.0032</td>
      <td>130</td>
      <td>1.000000</td>
      <td>6.123234e-17</td>
      <td>-0.866025</td>
      <td>0.5</td>
      <td>-0.900969</td>
      <td>-0.433884</td>
    </tr>
    <tr>
      <th>9915</th>
      <td>2012-11-16 07:00:00</td>
      <td>0</td>
      <td>1</td>
      <td>12.30</td>
      <td>61</td>
      <td>11.0014</td>
      <td>367</td>
      <td>0.965926</td>
      <td>-2.588190e-01</td>
      <td>-0.866025</td>
      <td>0.5</td>
      <td>-0.900969</td>
      <td>-0.433884</td>
    </tr>
    <tr>
      <th>9916</th>
      <td>2012-11-16 09:00:00</td>
      <td>0</td>
      <td>1</td>
      <td>13.94</td>
      <td>53</td>
      <td>7.0015</td>
      <td>351</td>
      <td>0.707107</td>
      <td>-7.071068e-01</td>
      <td>-0.866025</td>
      <td>0.5</td>
      <td>-0.900969</td>
      <td>-0.433884</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will do training and cross validation on the rest of the data. Lets create it</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">=</span> <span class="n">bike_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">last_five_percent_ind</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">data</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[28]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
      <th>holiday</th>
      <th>workingday</th>
      <th>temp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>count</th>
      <th>hour_sin</th>
      <th>hour_cos</th>
      <th>month_sin</th>
      <th>month_cos</th>
      <th>weekday_cos</th>
      <th>weekday_sin</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>9911</th>
      <td>2012-11-16 03:00:00</td>
      <td>0</td>
      <td>1</td>
      <td>12.3</td>
      <td>65</td>
      <td>8.9981</td>
      <td>6</td>
      <td>0.707107</td>
      <td>0.707107</td>
      <td>-0.866025</td>
      <td>0.5</td>
      <td>-0.900969</td>
      <td>-0.433884</td>
    </tr>
    <tr>
      <th>9912</th>
      <td>2012-11-16 04:00:00</td>
      <td>0</td>
      <td>1</td>
      <td>12.3</td>
      <td>65</td>
      <td>7.0015</td>
      <td>5</td>
      <td>0.866025</td>
      <td>0.500000</td>
      <td>-0.866025</td>
      <td>0.5</td>
      <td>-0.900969</td>
      <td>-0.433884</td>
    </tr>
    <tr>
      <th>9913</th>
      <td>2012-11-16 05:00:00</td>
      <td>0</td>
      <td>1</td>
      <td>12.3</td>
      <td>65</td>
      <td>6.0032</td>
      <td>36</td>
      <td>0.965926</td>
      <td>0.258819</td>
      <td>-0.866025</td>
      <td>0.5</td>
      <td>-0.900969</td>
      <td>-0.433884</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Features-and-Target-Variable">Features and Target Variable<a class="anchor-link" href="#Features-and-Target-Variable">&#182;</a></h3><p>Having splitted the hold-out dataset now time to create the features (X) and the target (y) datasets and fit a Linear Regression model</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Target data</span>
<span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>

<span class="c1"># Features data</span>
<span class="n">X</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[30]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>holiday</th>
      <th>workingday</th>
      <th>temp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>hour_sin</th>
      <th>hour_cos</th>
      <th>month_sin</th>
      <th>month_cos</th>
      <th>weekday_cos</th>
      <th>weekday_sin</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>9.84</td>
      <td>81</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>-0.222521</td>
      <td>-0.974928</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0</td>
      <td>9.02</td>
      <td>80</td>
      <td>0.0</td>
      <td>0.258819</td>
      <td>0.965926</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>-0.222521</td>
      <td>-0.974928</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0</td>
      <td>9.02</td>
      <td>80</td>
      <td>0.0</td>
      <td>0.500000</td>
      <td>0.866025</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>-0.222521</td>
      <td>-0.974928</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Notes-about-Cross-Validation-of-Timeseries-data">Notes about Cross Validation of <code>Timeseries</code> data<a class="anchor-link" href="#Notes-about-Cross-Validation-of-Timeseries-data">&#182;</a></h2><p>Here is the the notes from <a href="https://scikit-learn.org/stable/modules/cross_validation.html#cross-validation">sklearn official page</a> :</p>
<p>Time series data is characterised by the <code>correlation between observations that are near in time (autocorrelation)</code>.</p>
<p>However, classical cross-validation techniques such as <code>KFold</code> and <code>ShuffleSplit</code></p>
<ul>
<li>assume the samples are <code>independent and identically distributed</code>, and </li>
<li>would result in unreasonable correlation between training and testing instances (yielding poor estimates of generalisation error) on time series data. </li>
</ul>
<p>Therefore, it is very important to evaluate our model for time series data on the <code>“future” observations</code> least like those that are used to train the model.</p>
<h3 id="Time-Series-Split"><strong><code>Time Series Split</code></strong><a class="anchor-link" href="#Time-Series-Split">&#182;</a></h3><p><code>TimeSeriesSplit</code> is a variation of k-fold which</p>
<ul>
<li>returns first <code>k</code> folds as train set and </li>
<li>the <code>k+1 th</code> fold as test set. </li>
</ul>
<ul>
<li>We should <strong>not shuffle</strong> our data when making predictions with timeseries.</li>
<li>Unlike standard cross-validation methods, successive training sets are <code>supersets</code> of those that come before them. </li>
<li>Also, it adds all <code>surplus data</code> to the <code>first training partition</code>, which is always used to train the model.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Sklearn-Pipeline">Sklearn Pipeline<a class="anchor-link" href="#Sklearn-Pipeline">&#182;</a></h2><p>Whenever possible, using sklearn Pipeline object is always a smart practice because they</p>
<ul>
<li>are powerfull tools to standardise our operations,</li>
<li>create an easy-to-understand workflow with clear order of steps,</li>
<li>are reproducable</li>
</ul>
<p>We will create a pipeline with <code>StandartScaler</code> and <code>LinearRegression</code> objects</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Instantiate the pipeline with the StandardScaler and  LinearRegression</span>
<span class="n">pipeline</span><span class="o">=</span><span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
                          <span class="p">(</span><span class="s2">&quot;linreg&quot;</span><span class="p">,</span> <span class="n">LinearRegression</span><span class="p">())])</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Cross-validation-scores">Cross validation scores<a class="anchor-link" href="#Cross-validation-scores">&#182;</a></h2><p>Let's use the <code>cross_val_score</code> from <code>sklearn.metrics</code> to get the scores of each split</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[32]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Split the timeseries data</span>
<span class="n">split</span> <span class="o">=</span> <span class="n">TimeSeriesSplit</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Fit and score the model with cross-validation</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">split</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R^2 scores of each split:&quot;</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>R^2 scores of each split: [0.27492746 0.32817026 0.19586317 0.37070607 0.41382806]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Visualizing-CV-Splits-for-Timeseries:-TimeSeriesSplit">Visualizing CV Splits for Timeseries: <code>TimeSeriesSplit</code><a class="anchor-link" href="#Visualizing-CV-Splits-for-Timeseries:-TimeSeriesSplit">&#182;</a></h2><p>Visualize the splits of cross validation with <code>TimeSeriesSplit</code> object</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[33]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Initialize the cross-validation iterator with 10 splits</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">TimeSeriesSplit</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> 

<span class="c1"># Loop over the cross validation splits</span>
<span class="c1"># cv.split() method creates train and test array for each split</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)):</span>

    <span class="c1"># Plot training and test indices</span>
    <span class="n">l1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">coolwarm</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">coolwarm</span><span class="p">(</span><span class="o">.</span><span class="mi">9</span><span class="p">)],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;TimeSeriesSplit behavior&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Data index&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;CV iteration&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Training&#39;</span><span class="p">,</span> <span class="s1">&#39;Validation&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAmkAAAFRCAYAAAAvsDqPAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADl0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uIDIuMi4yLCBodHRwOi8vbWF0cGxvdGxpYi5vcmcvhp/UCwAAIABJREFUeJzt3X98zvX+x/Hntc1IG2M2Sh1Ofhy/VhFqEVpKbENajqhEiBSl4/dw8ptDwvop5ZQ4KcOXI+FoFXOoTifqJOowimyG2ez3db2/f3TOdYgZs+u63rPH/a99Ptfn83m/rs+rj5639+e6PpfDGGMEAAAAq/j5ugAAAACci5AGAABgIUIaAACAhQhpAAAAFiKkAQAAWIiQBgAAYCFCGgBJ0tSpU9WtWzd169ZNzZo1U6dOndzLubm56tatm06dOlVq4y1atEjdunVT165dFRMTo1mzZik/P/+SjzNw4EB9//33Ja4jMTFRPXr0UNeuXRUdHa3x48crMzOz2P2ioqK0e/du7d69W8OGDZMk7dq1SxMnTrzg9pdi4cKFmjx58iXtU5Qz6wRQNgT4ugAAdoiPj3f/HRUVpTlz5igiIsK9bs2aNaU21gcffKDNmzfr3XffVaVKlZSXl6dhw4YpISFBI0aMuKRjLVq0qMR17Nq1Sy+++KJWrlypkJAQOZ1OPffcc/rjH/+ouXPnXtQxIiIitGDBAknS999/r6NHj5a4Hk86s04AZQMhDcBF+d3vfqft27crKSlJGzdulMvl0uHDh1WzZk317NlTS5cu1YEDB9SvXz/1799fkvTee+9p+fLlcrlcCgkJ0YQJE1SvXj2lpaXJ6XQqNzdXlSpVUsWKFTVhwgQdP35ckpSfn685c+bos88+k9PpVJMmTRQfH6+goCBFRUXpxhtv1HfffacRI0ZoxowZmj9/viIiIrRlyxa9/PLLKigoUKVKlTR69Gg1b95cP/zwg8aPH6/8/HwZYxQXF6c+ffooLS1Nxhjl5uZKkvz9/TV8+HDt27dP0i8zWSkpKfr555+VlpamRo0aadq0aQoKCnKflx07dmjKlClatGiRFixYoMzMTI0dO1YzZsw45xwuW7ZMe/bsUX5+vvr166e4uDhJKrJuSfr3v/+thx9+WGlpaapRo4aef/55hYeH66OPPtKrr76q/Px8HT9+XN27d9fTTz+tZ599Vk2bNnX3YNmyZdq5c6cefPBBTZkyRevWrVNmZqaee+457dmzRw6HQ3fccYdGjBihgIAANWvWTHfddZf27NlzTlAH4GUGAH7lzjvvNLt27TprXcOGDU16erpZuXKlueWWW8zhw4eN0+k0Xbp0MU899ZRxOp3m22+/NREREcbpdJodO3aY3r17m+zsbGOMMZ9++qm59957jTHGnDp1yvTr1880bdrU9OzZ08yYMcPs3LnTPdbChQvNzJkzjcvlMsYYM3fuXDNp0iR3bQkJCefUun//fhMTE2OOHz9ujDFm7969pk2bNub06dNm7Nix5tVXXzXGGJOammqefvpp43Q6TX5+vhkxYoRp3Lix6d69u3nuuefMRx995B53wYIFpl27diYtLc04nU4zYsQIM3PmzLPG/fvf/26io6ONMcasXLnSDBo0qMhz+t/38PPPP5vIyEizd+/eC9a9YMECExUVZdLT040xxgwZMsQkJCQYl8tlHnroIbN//3738Ro3bmzS09PN9u3bTUxMjHvcuLg4s23btrPqHDVqlJkyZYpxuVwmLy/P9O/f331+GjZsaFatWlXMfyEAvIGZNACXLCIiQtdcc40k6brrrlPbtm3l5+en66+/Xnl5ecrJyVFSUpJSUlLUq1cv936nTp3SyZMnFRISojfeeEOHDh3S3//+d+3cuVODBg1S7969NXLkSCUlJSkzM1PJycmSpIKCAoWGhrqP07Jly3Nq2rZtm1JTU/Xoo4+61zkcDh08eFB33323Ro8erV27dikyMlLx8fHy8/OTn5+f5s6dq1GjRmnHjh367LPPNHr0aEVGRuqFF16QJN17772qUaOGJCkuLk7Tp0/X6NGjS3Te/nsuatasqTZt2mj79u3y9/cvsm5JatOmjapXry5JatSokY4fPy6Hw6FXXnlFSUlJWrdunX744QcZY5STk6Nbb71VeXl52r17t6666iodP35ckZGR2rlzp/v4n3zyiZYvXy6Hw6HAwED16tVLf/7znzVo0KAizy8A7yOkAbhkgYGBZy0HBJz7T4nL5VK3bt00cuRI93JqaqqqVq2qRYsW6ZZbblGLFi10/fXX64EHHtDnn3+ugQMHauTIkXK5XBo3bpzat28vSTp9+rTy8vLcx65cufJ5xzszXEnSkSNHFB4erkaNGunDDz9UcnKytm/frhdffFGJiYnaunWrqlWrprvuuktdu3ZV165dNWTIEEVFRblvvfr7+581hp9fyb9vdea+LpdLAQEBcjqdRda9adOms86tw+GQMUbZ2dm677771LFjR7Vs2VL333+/Nm/eLGOMHA6H4uLitGbNGlWoUEFxcXFyOBznnKsz17lcLhUWFrqXz3d+AXgf3+4E4BFt27bVX//6V6WmpkqSli9frr59+0qScnNzNXfuXJ08edK9/d69e9WkSRP3vu+8847y8/Plcrk0YcIEPf/88xccLzIyUtu2bdMPP/wgSfr444/VtWtX5ebm6tlnn9X69esVHR2tSZMmKSgoSAcPHpSfn5/mzJmjn3/+2X2cffv26dprr1XVqlUlSX/729+UmZkpl8ulFStW6M477yyyBn9//7PCzq+tWrVKknT48GFt375dkZGRF6y7KCkpKcrKytLTTz+tqKgo7dixw32uJOm+++7Tli1b9OGHH6pHjx7n7N+2bVstXbpUxhjl5+drxYoVuv3224scD4BvMJMGwCPatm2rgQMHqn///nI4HAoKClJCQoIcDoeeeOIJORwO9erVSw6HQy6XS82aNXPPJj3xxBOaNWuW7rvvPjmdTjVu3Fhjxoy54Hj169fX5MmTNWLECBljFBAQoJdffllXX321nnjiCY0fP17vvvuu/P391bFjR7Vq1UqtW7dWTk6OBg4cqPz8fDkcDtWtW1eLFy92z6DVqFFDAwcO1IkTJ9SqVSsNHjy4yBpuvvlmvfjii3ryySeVkJBwzut5eXm67777VFBQoPj4eP32t7+VpCLrLsrvfvc7dejQQZ07d1ZgYKAaNmyo+vXrKyUlRb/5zW8UFhamJk2aqLCwUDVr1jxn//j4eE2dOlWxsbEqKCjQHXfcccH3BcA3HMYY4+siAMBGCxcu1IkTJ4p89hkAeBK3OwEAACzETBoAAICFmEkDAACwECENAADAQoQ0AAAACxHSAAAALFSmn5N24sRpuVze+95DaGiQ0tOzvDYeikdP7ENP7ENP7ERf7OOpnvj5OVStWtHPPixKmQ5pLpfxakj775iwCz2xDz2xDz2xE32xj0094XYnAACAhQhpAAAAFiKkAQAAWIiQBgAAYCFCGgAAgIUIaQAAABYipAEAAFioTD8nDQAAlG1z587S7t1fqbCwQD/+eEh1694gSXrggV6Kju5a7P6v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/vvvdfvttys5OVm33HJLiYp888033X8nJiZq586dJQ5oAAAAV7Jifxbq8OHDeu2119SuXTs99NBDWr58uf797397ozYAAIByq9iZtBo1akiS6tatq71796pr164qLCy87IF79OihHj16XPZxPG3+s//7nVKmpu1DT+zj2Z7wbDEA5UexIS00NFSvv/66br75Zi1cuFBBQUHKzc31Rm0AAADlVrG3OydPnqzAwEC1bNlSzZo104IFC/SHP/zBG7UBAACUW8XOpM2aNUuzZ8+WJI0cOVIjR470eFEAAADlXbEzad9++62M4TEXAAAA3lTsTFp4eLiio6N100036eqrr3avj4+P92hhAAAA5VmxIa158+Zq3ry5N2oBAADAfxQb0p588knl5uYqJSVFDRo0UF5enq666ipv1AYAAFBuFfuZtK+++kodO3bU448/rtTUVHXo0EH/+Mc/vFEbAABAuVVsSJs1a5aWLFmikJAQ1apVS7Nnz9a0adO8URsAAEC5VWxIy83NVf369d3L7du3l9Pp9GhRAAAA5V2xIS0gIEAZGRlyOBySxO92AgAAeEGxXxwYPHiwHnroIR07dkwjRozQtm3bNHnyZG/UBgAAUG4VG9KioqJUr149bdu2TS6XS0OHDlW9evW8URsAAEC5VeztznHjxqlOnTrq3bu3HnroIdWrV0/Dhg3zRm0AAADlVpEzaZMmTdLRo0f1xRdf6Pjx4+71hYWFOnTokFeKAwAAKK+KDGlxcXHat2+fvvvuO3Xq1Mm93t/fXzfffLNXirPB8LkZZyxlFLkdfIWe2IeenGnCvn6+LkHHSvFYNV5JLMWjAbiQIkNaRESEIiIi1KZNG9WsWdObNQEAAJR7RYa04cOHa/78+RowYMB5X1+7dq3HigIAACjvigxpAwcOlCRNmDDBa8UAAADgF0WGtGbNmkmSWrdu7bViAAAA8ItiH8EBAAAA7yOkAQAAWKjIkLZ582YZY7xZCwAAAP7DYYpIYrGxsTp9+rR69eqluLg4Va9e3du1FSs9PUsul/eCZFhYsNLSMr02HopHT+xDT+xDT+xEX+zjqZ74+TkUGhp06fsV9cLatWs1d+5c7d+/X507d9bo0aO1a9euyyoSAAAAF+eCP7DevHlzNW/eXFlZWVqzZo0mTpwof39/Pfzww+revbu3agQAACh3LuqLA0FBQerT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CFBsbKw2bNign376Sbm5ubr55pslST169NCGDRtUUFCgzz77TJ06dTprPUru5MmTmjdvngYPHixJJTr3SUlJio2NlSTFxMTok08+UUFBgQ/eTdm3adMmdenSRbVq1VKFChU0b948XXXVVVwnPuZ0OuVyuZSTk6PCwkIVFhYqICCAa8UHVqxYoUmTJik8PFyStGvXrlK7PrzZH0JaMVJTUxUWFuZeDg8P19GjR31Y0ZWtQYMG7ovlwIED+uCDD+RwOM7bg1/3JiwsTEePHtWJEycUFBSkgICAs9aj5CZOnKhnnnlGVapUkXTudXEx5/7MfQICAhQUFKTjx497+Z1cGVJSUuR0OjV48GB169ZNy5YtK/LfKq4T7wkKCtLw4cPVuXNntW/fXrVr11aFChW4Vnxg2rRpatmypXu5NK8Pb/aHkFYMl8slh8PhXjbGnLUMz9i3b5/69++vUaNG6frrrz9vD4rqzfl6RM9K7r333tM111yjyMhI97rSOPfGGPn58U9QSTidTm3fvl3Tp0/Xu+++q127dunQoUNcJz62Z88erVy5Uh999JE+/fRT+fn5adu2bVwrFijqOrD937IAjxz1ClKrVi19/vnn7uW0tDT39Ck844svvtCwYcM0btw4RUdHa+fOnWd9MPO/PahVq9ZZ648dO6bw8HBVr15dmZmZcjqd8vf3p2eXaf369UpLS1O3bt2UkZGh7OxsORyOSz734eHhOnbsmGrVqqXCwkKdPn1aISEhvnpbZVqNGjUUGRmp6tWrS5I6duyoDRs2yN/f370N14n3bd26VZGRkQoNDZX0yy2yxYsXc61Y4NfXweVcH97sD9G8GLfffru2b9+u48ePKycnRxs3blS7du18XdYV68iRIxo6dKjmzJmj6OhoSdJNN92k/fv3u2/xrFu3Tu3atVPt2rVVsWJFffHFF5J++VZVu3btVKFCBbVs2VLr16+XJK1evZqeXYY333xT69at05o1azRs2DBFRUVpxowZl3zu27dvr9WrV0v6Jfi1bNlSFSpU8M2bKuPuvPNObd26VadOnZLT6dSnn36qe++9l+vExxo1aqTk5GRlZ2fLGKMtW7aodevWXCsWKM3/j3izPw5jjPHIka8ga9eu1auvvqqCggLFxcVp4MCBvi7pijV16lStXLlSv/nNb9zrevXqpbp162rGjBnKy8tT+/btNXbsWDkcDu3Zs0fx8fHKyspS06ZNNWPGDAUGBuqnn37SmDFjlJ6ermuuuUbPP/+8qlat6sN3dmVITEzUzp07NXPmzEs+9ydPntSYMWN06NAhBQcHa86cObruuut8/ZbKrPfff19LlixRQUGB2rRpo/j4eO3YsYPrxMdee+01JSYmqkKFCoqIiNCkSZO0f/9+rhUfiYqK0ltvvaXrrrtO27dvL5Xrw5v9IaQBAABYiNudAAAAFiKkAQAAWIiQBgAAYCFCGgAAgIUIaQAAABbiYbYArPbjjz/q7rvvVsOGDSX98uTwq6++Wo888oi6dOlS7P4JCQlq1KiROnbseNFjzp8/X3Xq1FH37t0vep/Fixdr3759mjlz5kXvAwAXQkgDYL1KlSppzZo17uWffvpJjz76qPz9/d0/gFyUHTt2qH79+pc03vDhw0tUJwCUJkIagDKndu3aGjZsmBYvXqxOnTpp//79mjx5sk6fPq20tDQ1atRIL7zwgt5//319/fXXmj17tvz9/VW/fv3zblexYsWzjj9mzBg1aNBAjz32mCIiIjRo0CBt27ZNqampGjBggHr37q2CggJNnTpVycnJCg0NVWhoqIKDgyVJmZmZmjZtmvbu3auCggJFRkZq1KhRSklJUa9evfTWW2+pcePGGjVqlAICAjR9+nRfnEYAluMzaQDKpEaNGmnv3r2SpBUrVqh79+5asWKFNm7cqB9//FFJSUnq06ePmjVrplGjRunuu+8ucrsLyc/PV7Vq1fSXv/xFCxYscD+xfNmyZTpw4ID++te/6o033tCRI0fc+0yfPl1NmzZVYmKiVq9erRMnTujNN99UvXr1NHLkSI0ePVrvvfee9uzZo4kTJ3ryNAEow5hJA1AmORwOVapUSZI0cuRIbdu2TYsWLdKBAweUmpqq7Ozsc/a52O1+7a677pIkNW3aVPn5+crOztb27dsVExOjwMBABQYGKjY2Vt99950kKSkpSbt379b7778vScrNzXUfq2fPntq6daumTp2qNWvWuN8DAPwaIQ1AmbR79273lwlGjBghp9Opzp07q0OHDjpy5IjO94t3F7vdr/33dqjD4ZCk8+7j7+/v/tvlcmn+/PmqV6+eJOnUqVPuffPz85WSkqLg4GB9++23qlu37qW9cQDlBrc7AZQ5+/fv10svvaT+/ftLkrZu3aqhQ4e6v+351Vdfyel0SvolPBUWFha73aW64447tHr1auXl5SkvL0/r1693v9a2bVstWbJExhjl5+dryJAhWrp0qSRp9uzZatCggRYvXqypU6fqp59+KtlJAHDFYyYNgPVyc3PVrVs3SZKfn58qVqyoESNGqEOHDpKkZ555RkOHDlXlypUVFBSkVq1a6eDBg5KkqKgoPf/88yooKLjgdpeqV69eOnjwoGJiYhQSEqI6deq4Xxs/frymTZum2NhYFRQU6Pbbb9eAAQOUlJSkTZs2ae3atapSpYr69u2rZ599VkuXLlVAAP8cAzibw1zMXD8AAAC8itudAAAAFiKkAQAAWIiQBgAAYCFCGgAAgIUIaQAAABYipAEAAFiIkAYAAGAhQhoAAICF/h9yHV2iONp52AAAAABJRU5ErkJggg==
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Scoring-Metric:-RMSLE">Scoring Metric: <code>RMSLE</code><a class="anchor-link" href="#Scoring-Metric:-RMSLE">&#182;</a></h2><p>Lets try to understand the metric which will be used for the Kaggle evaluation. Here is the screen shot from the Kaggle evaluation page.</p>
<p><img src="img_bike2/scoring.png" alt="scoring"></p>
<p>Obviously it is of great importance to understand and use the metrics properly also in machine learning. Deriving insights without making clear sense of metrics is like to choosing between 1 litre milk and 0.6 galon milk. If we dont know the metrics litre and galon we can't make a healty decision.</p>
<p>So we need to take into account the metric <code>Root Mean Squared Log Error(RMSLE)</code> for this project but how can we interpret this metric?</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="img_bike2/cost.png" alt="cost"></p>
<p><strong>Mechanism</strong>:</p>
<ul>
<li>It is the Root Mean Squared Error of the <strong>log-transformed predicted</strong> and <strong>log-transformed actual values</strong>. </li>
<li><p><code>RMSLE</code> adds <code>1</code> to both actual and predicted values before taking the natural logarithm to avoid taking the natural log of <code>0 (zero)</code>.</p>
</li>
<li><p>As a result, the function can be used if actual or predicted have <strong>zero-valued</strong> elements. But this function is not appropriate if either is <strong>negative valued</strong></p>
</li>
</ul>
<p><strong>Functionality:</strong></p>
<ul>
<li><p>The expression $$ log(p_i +1) − log(a_i+1)$$ can be written as $$ log((p_i+1) / (a_i+1)) $$</p>
</li>
<li><p>RMSLE measures the ratio between predicted and actual.</p>
</li>
</ul>
<blockquote><p>RMSLE is preferable when</p>
<ul>
<li>we care about <strong>percentage errors</strong> rather than the <strong>absolute value of errors</strong>.</li>
<li>there is a wide range in the target variables and</li>
<li>we <strong>don’t want to penalize big differences</strong> when <strong>both the predicted and the actual are big numbers</strong>.</li>
<li>we want to <strong>penalize under estimates more than over estimates</strong>.</li>
</ul>
</blockquote>
<p>Let's imagine two cases of predictions,</p>
<ul>
<li>Case-1: our model predicts the number of bike rentals as <code>30</code> when the actual number is <code>40</code> </li>
<li><p>Case-2: our model predicts the number of rentals as <code>300</code> when the actual number is <code>400</code></p>
</li>
<li><p>For RMSLogE two results are scored the same</p>
</li>
<li><p>Conversely, with RMSE the second result is scored as <code>10 times</code> more than the first result</p>
</li>
</ul>
<p>The decisions always depends on the domains or business cases and for the bike rentals business and the ranges this feature of RMSLE looks like a suitable.</p>
<p>Lets have a look at the below example</p>
<ul>
<li><p>Case-3 :</p>
<ul>
<li><p>Prediction = <code>600</code>, Actual = <code>1000</code></p>
</li>
<li><p>RMSE = <code>400</code>,</p>
</li>
<li>RMSLogE = <code>0.5108</code></li>
</ul>
</li>
</ul>
<ul>
<li><p>Case-4 :</p>
<ul>
<li><p>Prediction = <code>1400</code>, Actual = <code>1000</code></p>
</li>
<li><p>RMSE = <code>400</code>,</p>
</li>
<li>RMSLogE = <code>0.3365</code></li>
</ul>
</li>
</ul>
<ul>
<li>When the differences are same between <strong>actual</strong> and <strong>predicted</strong> in both the cases. <ul>
<li>RMSE treated them equally, however </li>
<li>RMSLogE penalized the under estimate more than over estimate (under estimated prediction score is higher than over estimated prediction score)</li>
</ul>
</li>
</ul>
<p>This second feature of RSMLE is also plausible for bike business in my opinion. Having extra bikes is preferable to not being able to supply as many bikes as the demand</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="RSMLE-Calculator-Function">RSMLE Calculator Function<a class="anchor-link" href="#RSMLE-Calculator-Function">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Define the RSMLE function for error calculation: rsmsle_calculator</span>
<span class="c1"># Using the vectorized numpy functions instead of loops always better for computation</span>
<span class="k">def</span> <span class="nf">rmsle_calculator</span><span class="p">(</span><span class="n">predicted</span><span class="p">,</span> <span class="n">actual</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">predicted</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">predicted</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">actual</span><span class="p">),</span> <span class="mi">2</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Custom-Scoring-Function">Custom Scoring Function<a class="anchor-link" href="#Custom-Scoring-Function">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li><p>Having defined our function for the RMSLE calculation, now we should define a scoring function in order to use as a scoring parameter for <code>model_selection.cross_val_score</code></p>
</li>
<li><p>We need this parameter for model-evaluation tools which rely on a scoring strategy when using cross-validation internally (such as <code>model_selection.cross_val_score</code> and <code>model_selection.GridSearchCV</code>)</p>
</li>
</ul>
<p>We will use <code>make_scorer</code> function of sklearn to generate a callable object (our <code>rsmle_calculator</code> function) for scoring. <br>
When defining a custom scorer via <code>sklearn.metrics.make_scorer</code>, the convention is that</p>
<ul>
<li>custom functions ending in <code>_score</code> return a value to maximize and</li>
<li>for scorers ending in <code>_loss</code> or <code>_error</code>, a value is returned to be minimized. </li>
<li>We can use this functionality by setting the <code>greater_is_better</code> parameter inside <code>make_scorer</code>. </li>
<li>This parameter would be <ul>
<li><code>True</code> for scorers where higher values are better, and</li>
<li><code>False</code> for scorers where lower values are better. (this will be our choise since the lower RSMLE values are better)</li>
</ul>
</li>
</ul>
<p><strong>NOTE:</strong></p>
<ul>
<li>If a loss, the output of the python function is negated by the scorer object, conforming to the cross validation convention that scorers return higher values for better models.</li>
<li>When <code>greater_is_better</code> is <code>False</code>, the scorer object will sign-flip the outcome of the <code>score_func</code>.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[35]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Make a custom scorer </span>
<span class="c1"># rmsle_error will negate the return value of rmsle_calculator,</span>
<span class="n">rmsle_error</span> <span class="o">=</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">rmsle_calculator</span><span class="p">,</span> <span class="n">greater_is_better</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[36]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Fit and score the model with cross-validation</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">split</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">rmsle_error</span><span class="p">)</span>
<span class="n">scores</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[36]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>array([-1.06115722, -0.97511162, -1.02056734, -0.93509628, -0.92447915])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As explained the scores are negative due to the sklearn customs. We can multiply the results by <code>-1</code> for interpretation</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[37]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The cross validation scores:&quot;</span><span class="p">,</span> <span class="n">scores</span><span class="o">*-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The cross validation scores: [1.06115722 0.97511162 1.02056734 0.93509628 0.92447915]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Hold-out-Data-Prediction-Scores">Hold-out Data Prediction Scores<a class="anchor-link" href="#Hold-out-Data-Prediction-Scores">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[38]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Hold-out target data </span>
<span class="n">y_hold</span><span class="o">=</span><span class="n">hold_out_df</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>

<span class="c1"># Hold-out features data</span>
<span class="n">X_hold</span><span class="o">=</span><span class="n">hold_out_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Fit the pipeline to train data</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># Generate predictions for hold-out data</span>
<span class="n">predictions_hold</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_hold</span><span class="p">)</span>

<span class="c1"># R^2 score</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_hold</span><span class="p">,</span> <span class="n">predictions_hold</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R^2 score of hold-out:&quot;</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Root mean squared error of hold-out:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_hold</span><span class="p">,</span> <span class="n">predictions_hold</span><span class="p">)))</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;RMSLE value for linear regression of hold-out: &quot;</span><span class="p">,</span> <span class="n">rmsle_calculator</span><span class="p">(</span><span class="n">y_hold</span> <span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">predictions_hold</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>R^2 score of hold-out: 0.3889173616885714
Root mean squared error of hold-out: 120.48857034926871
RMSLE value for linear regression of hold-out:  0.715555147546642
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Kaggle-submission">Kaggle submission<a class="anchor-link" href="#Kaggle-submission">&#182;</a></h2><p>Lets predict the given Kaggle test set and submit the predictions to Kaggle to get our score. <br>
First it would be better if we combine our <code>X</code> and <code>X_hold</code> and <code>y</code> and <code>y_hold</code> datasets then train our model with more data in order to let our model learn better before predicting on a new test data i.e Kaggle test data which we have not yet uploaded.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[39]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Combine X and X hold: combined_train</span>
<span class="n">combined_X</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">X_hold</span><span class="p">])</span>

<span class="c1"># Combine the y and y hold: combined_test</span>
<span class="n">combined_y</span> <span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">y</span><span class="p">,</span> <span class="n">y_hold</span><span class="p">])</span>

<span class="c1"># Fit the model to the combined datasets</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">combined_X</span><span class="p">,</span> <span class="n">combined_y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[39]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>Pipeline(memory=None,
     steps=[(&#39;scaler&#39;, StandardScaler(copy=True, with_mean=True, with_std=True)), (&#39;linreg&#39;, LinearRegression(copy_X=True, fit_intercept=True, n_jobs=1, normalize=False))])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[40]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Read the Kaggle test data</span>
<span class="n">kaggle_test</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;bike_kaggle_test.csv&quot;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">)</span>
<span class="n">kaggle_test</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[40]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>holiday</th>
      <th>workingday</th>
      <th>weather</th>
      <th>temp</th>
      <th>atemp</th>
      <th>humidity</th>
      <th>windspeed</th>
    </tr>
    <tr>
      <th>datetime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-20 00:00:00</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>10.66</td>
      <td>11.365</td>
      <td>56</td>
      <td>26.0027</td>
    </tr>
    <tr>
      <th>2011-01-20 01:00:00</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>10.66</td>
      <td>13.635</td>
      <td>56</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>2011-01-20 02:00:00</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>10.66</td>
      <td>13.635</td>
      <td>56</td>
      <td>0.0000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Lets also apply all the steps that we followed for train data to the test data</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[41]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">kaggle_test</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">kaggle_test</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span>
<span class="n">kaggle_test</span><span class="p">[</span><span class="s2">&quot;weekday&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">kaggle_test</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">dayofweek</span>
<span class="n">kaggle_test</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">kaggle_test</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span>

<span class="c1"># Create the sin and cos components of hour, month and weekday columns</span>
<span class="n">kaggle_test</span><span class="p">[</span><span class="s1">&#39;hour_sin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">kaggle_test</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">24</span><span class="p">))</span>
<span class="n">kaggle_test</span><span class="p">[</span><span class="s1">&#39;hour_cos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">kaggle_test</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">24</span><span class="p">))</span>
<span class="n">kaggle_test</span><span class="p">[</span><span class="s1">&#39;month_sin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">kaggle_test</span><span class="o">.</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">12</span><span class="p">))</span>
<span class="n">kaggle_test</span><span class="p">[</span><span class="s1">&#39;month_cos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">kaggle_test</span><span class="o">.</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">12</span><span class="p">))</span>
<span class="n">kaggle_test</span><span class="p">[</span><span class="s2">&quot;weekday_cos&quot;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">kaggle_test</span><span class="o">.</span><span class="n">weekday</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">7</span><span class="p">))</span>
<span class="n">kaggle_test</span><span class="p">[</span><span class="s1">&#39;weekday_sin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">kaggle_test</span><span class="o">.</span><span class="n">weekday</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">7</span><span class="p">))</span>

<span class="c1"># Drop the wrong represantation of time: month, weekday, hour</span>
<span class="c1"># Drop the correlated features: atemp, season</span>
<span class="c1"># Drop the weather column (not relaible data records)</span>
<span class="n">X_kaggle_test</span><span class="o">=</span> <span class="n">kaggle_test</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="s2">&quot;weekday&quot;</span><span class="p">,</span> <span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;atemp&quot;</span><span class="p">,</span> <span class="s2">&quot;weather&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_kaggle_test</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[41]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>holiday</th>
      <th>workingday</th>
      <th>temp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>hour_sin</th>
      <th>hour_cos</th>
      <th>month_sin</th>
      <th>month_cos</th>
      <th>weekday_cos</th>
      <th>weekday_sin</th>
    </tr>
    <tr>
      <th>datetime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-20 00:00:00</th>
      <td>0</td>
      <td>1</td>
      <td>10.66</td>
      <td>56</td>
      <td>26.0027</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>-0.900969</td>
      <td>0.433884</td>
    </tr>
    <tr>
      <th>2011-01-20 01:00:00</th>
      <td>0</td>
      <td>1</td>
      <td>10.66</td>
      <td>56</td>
      <td>0.0000</td>
      <td>0.258819</td>
      <td>0.965926</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>-0.900969</td>
      <td>0.433884</td>
    </tr>
    <tr>
      <th>2011-01-20 02:00:00</th>
      <td>0</td>
      <td>1</td>
      <td>10.66</td>
      <td>56</td>
      <td>0.0000</td>
      <td>0.500000</td>
      <td>0.866025</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>-0.900969</td>
      <td>0.433884</td>
    </tr>
    <tr>
      <th>2011-01-20 03:00:00</th>
      <td>0</td>
      <td>1</td>
      <td>10.66</td>
      <td>56</td>
      <td>11.0014</td>
      <td>0.707107</td>
      <td>0.707107</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>-0.900969</td>
      <td>0.433884</td>
    </tr>
    <tr>
      <th>2011-01-20 04:00:00</th>
      <td>0</td>
      <td>1</td>
      <td>10.66</td>
      <td>56</td>
      <td>11.0014</td>
      <td>0.866025</td>
      <td>0.500000</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>-0.900969</td>
      <td>0.433884</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Our Kaggle test dataset is in the same structure with our <code>combined_X</code> dataset. Time to predict and submit!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[42]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">final_predictions</span><span class="o">=</span><span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_kaggle_test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We need to create a dataframe complying with Kaggle submission format like shown in the screenshot
<img src="data:image/png;base64, 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" alt="resim.png"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[43]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">kaggle_sub</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;datetime&quot;</span><span class="p">:</span><span class="n">kaggle_test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">:</span><span class="n">final_predictions</span><span class="p">})</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;datetime&quot;</span><span class="p">)</span>
<span class="n">kaggle_sub</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">kaggle_sub</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
<span class="n">kaggle_sub</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[43]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
    </tr>
    <tr>
      <th>datetime</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-20 00:00:00</th>
      <td>29.463588</td>
    </tr>
    <tr>
      <th>2011-01-20 01:00:00</th>
      <td>32.955071</td>
    </tr>
    <tr>
      <th>2011-01-20 02:00:00</th>
      <td>22.045803</td>
    </tr>
    <tr>
      <th>2011-01-20 03:00:00</th>
      <td>9.850910</td>
    </tr>
    <tr>
      <th>2011-01-20 04:00:00</th>
      <td>14.729010</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[44]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Save the submission dataframe</span>
<span class="n">kaggle_sub</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;kaggle_sub.csv&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Kaggle-Submission-Score">Kaggle Submission Score<a class="anchor-link" href="#Kaggle-Submission-Score">&#182;</a></h2><p>When we fit our model to the Kaggle test set and submited we got the score below. This competition is closed so there is no ranking anymore but to get a bit of idea about our models performance the mean ranking and the two scores in the ranking that our score fall in between were below.</p>
<p>For the start of our project this is not a bad score. We have just tried Linear Regression so far and also we did not used new features except from the time features. Later we can work on this and i think our ranking can get better</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="img_bike2/kaggle1.png" alt="kaggle1"></p>
<p><img src="img_bike2/kaggle2.png" alt="kaggle2"></p>
<p><img src="img_bike2/kaggle3.png" alt="kaggle3"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Wrap-Up">Wrap Up<a class="anchor-link" href="#Wrap-Up">&#182;</a></h1><p>This was the second part of our analysis on bikeshare dataset <br></p>
<p>In this notebook we</p>
<ul>
<li>continued to prepare our dataset for machine learning</li>
<li>used to the trigonometric function for time data transformation in order to better represent the cyclic nature of time features</li>
<li>splitted our data set and keep an hould-out test set for final evaluation</li>
<li>used <code>TimeSeriesSplit</code> iterators for the cross validation of timeseries data. This was important in order to only using past data to evaluate our model on the “future” observations </li>
<li>used Sklearn Pipeline for better workflow</li>
<li>understood the mechanism and the functionality of the RSMLE metric</li>
<li>created a custom scoring function which uses RSMLE for the sklearn model evaluation tools </li>
<li>prepared and predicted the Kaggle testset and made a submission</li>
</ul>
<p>In the next post we will work on the analysis of the model performance especially with visualization tools</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Sources:<br>
<a href="https://scikit-learn.org/stable/modules/model_evaluation.html#defining-your-scoring-strategy-from-metric-functions">https://scikit-learn.org/stable/modules/model_evaluation.html#defining-your-scoring-strategy-from-metric-functions</a><br>
<a href="http://blog.davidkaleko.com/feature-engineering-cyclical-features.html">http://blog.davidkaleko.com/feature-engineering-cyclical-features.html</a> <br>
<a href="https://www.quora.com/What-is-the-difference-between-an-RMSE-and-RMSLE-logarithmic-error-and-does-a-high-RMSE-imply-low-RMSLE">https://www.quora.com/What-is-the-difference-between-an-RMSE-and-RMSLE-logarithmic-error-and-does-a-high-RMSE-imply-low-RMSLE</a></p>

</div>
</div>
</div>
 

